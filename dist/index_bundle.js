!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t){t.exports=JSON.parse("{}")},function(t,e,s){"use strict";s.r(e);const i=Math;function n(t){return i.sin(6.283184*t)}var r=[n,function(t){return n(t)<0?-1:1},function(t){return t%1-.5},function(t){var e=t%1*4;return e<2?e-1:3-e}];function o(t){return.00390625*i.pow(1.059463094,t-128)}function a(t){return{left:new Float32Array(t),right:new Float32Array(t)}}function h(t,e,s,i){for(var n=s.fx_delay_time*i>>1,r=s.fx_delay_amt/255,o=0;o<e-n;){var a=o,h=o+n;t.left[h]+=t.right[a]*r,t.right[h]+=t.left[a]*r,o++}}function c(t,e){var s=t.createBuffer(2,e.left.length,44100);return s.getChannelData(0).set(e.left),s.getChannelData(1).set(e.right),s}var l=function(t,e,s){this.ctx=t,this.instr=e,this.rowLen=s||5605,this.osc_lfo=r[e.lfo_waveform],this.osc1=r[e.osc1_waveform],this.osc2=r[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=i.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=i.pow(2,e.lfo_freq-8)/this.rowLen};l.prototype._genSound=function(t,e,s){for(var r=0,a=0,h=o(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),c=o(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),l=this.instr.fx_resonance/255,d=0,u=0,f=e.left.length,x=this.attack+this.sustain+this.release-1;x>=0;--x){var y=x+s,m=this.osc_lfo(y*this.lfoFreq)*this.instr.lfo_amt/512+.5,p=1;x<this.attack?p=x/this.attack:x>=this.attack+this.sustain&&(p-=(x-this.attack-this.sustain)/this.release);var g=h;this.instr.lfo_osc1_freq&&(g+=m),this.instr.osc1_xenv&&(g*=p*p),r+=g;var b=this.osc1(r)*this.instr.osc1_vol;g=c,this.instr.osc2_xenv&&(g*=p*p),a+=g,b+=this.osc2(a)*this.instr.osc2_vol,this.instr.noise_fader&&(b+=(2*i.random()-1)*this.instr.noise_fader*p),b*=p/255;var w=this.instr.fx_freq;this.instr.lfo_fx_freq&&(w*=m);var v=l*(b-u)-(d+=(w=1.5*i.sin(3.141592*w/44100))*u);switch(u+=w*v,this.instr.fx_filter){case 1:b=v;break;case 2:b=d;break;case 3:b=u;break;case 4:b=d+v}g=n(y*this.panFreq)*this.instr.fx_pan_amt/512+.5,b*=.00476*this.instr.env_master,y<f&&(e.left[y]+=b*(1-g),e.right[y]+=b*g)}},l.prototype._createAudioBuffer=function(t,e){var s=this.attack+this.sustain+this.release-1+32*this.rowLen,i=a(s);this._genSound(t,i,0),h(i,s,this.instr,this.rowLen),e(c(this.ctx,i))};var d=function(t,e){this.ctx=t,this.song=e,this.waveSize=44100*e.songLen};d.prototype._generateTrack=function(t,e,s){var i=a(this.waveSize),n=this.waveSize,r=this.song.rowLen,o=this.song.endPattern,c=new l(this.ctx,t,r),d=0,u=0,f=0,x=function(){for(var e=Date.now();;)if(32!==f){if(u===o-1)return y();var s=t.p[u];if(s){var n=t.c[s-1].n[f];n&&c._genSound(n,i,d)}if(d+=r,f+=1,Date.now()-e>33)return void setTimeout(x,0)}else f=0,u+=1},y=function(){h(i,n,t,r);for(var o=0;o<n;o++)e.left[o]+=i.left[o];for(o=0;o<n;o++)e.right[o]+=i.right[o];s()};x()},d.prototype._createAudioBuffer=function(t){var e=this,s=a(this.waveSize),i=0,n=function(){i<e.song.songData.length?(i+=1,e._generateTrack(e.song.songData[i-1],s,n)):t(c(e.ctx,s))};n()};new(window.webkitAudioContext||window.AudioContext);s(0);var u=[],f=[],m={},p="_sign",g="_mask";"undefined"!=typeof Symbol&&(p=Symbol(p),g=Symbol(g));var b=function(t,e){var s=e[t];if(!s)throw new Error("The component is not registered");return s},w=b.bind(null,p),v=b.bind(null,g),M=function(t){t.id&&u.forEach((function(e){return e.match(t)}))},S=1,_={},k=function(t){this.id=t||(S++).toString(36),this.components=Object.assign({},_),this.mask=0};k.prototype.add=function(){for(var t=this,e=[],s=arguments.length;s--;)e[s]=arguments[s];e.forEach((function(e){t.components[w(e.constructor)]=e,t.mask|=v(e.constructor)})),M(this)},k.prototype.remove=function(){for(var t=this,e=[],s=arguments.length;s--;)e[s]=arguments[s];e.forEach((function(e){var s=w(e),i=t.components[s];i&&(i.destructor&&i.destructor(),delete t.components[s],t.mask&=~v(e))})),M(this)},k.prototype.has=function(t){return w(t)in this.components},k.prototype.get=function(t){return this.components[t[p]]},k.prototype.eject=function(){!function(t){var e=t.components;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var i=e[s];i&&i.destructor&&i.destructor()}u.forEach((function(e){return e.remove(t)})),delete m[t.id],t.id=0}(this)};var A=function(t,e){this.entity=t,this.prev=null,this.next=e},P=function(t){if(!t)throw new Error("Empty selector");for(var e in this.mask=t,this.map={},this.list=null,this.length=0,m)Object.prototype.hasOwnProperty.call(m,e)&&this.match(m[e])};P.prototype.iterate=function(t){for(var e=this.list;e;)t(e.entity),e=e.next},P.prototype.match=function(t){(this.mask&t.mask)===this.mask?this.add(t):this.remove(t)},P.prototype.add=function(t){if(!this.map[t.id]){var e=new A(t,this.list);this.list&&(this.list.prev=e),this.list=e,this.map[t.id]=e,this.length++}},P.prototype.remove=function(t){var e=this.map[t.id];e&&(e.prev?e.prev.next=e.next:this.list=e.next,e.next&&(e.next.prev=e.prev),delete this.map[t.id],this.length--)};var D=0,E=performance||Date,C=E.now.bind(E),L={register:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach((function(t){if(D>31)throw new Error("Components limit reached");if(!t[p]){var e=D.toString(36);_[e]=null,t[p]=e,t[g]=1<<D,D++}}))},process:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach((function(t){return f.push(t)}))},create:function(t){var e=new k(t);if(m[e.id])throw new Error("The ID already exist");return m[e.id]=e,e},get:function(t){return m[t]},select:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var s=0;t.forEach((function(t){s|=v(t)}));for(var i=0;i<u.length;i++)if(u[i].mask===s)return u[i];var n=new P(s);return u.push(n),n},update:function(t){var e={};return f.forEach((function(s){var i=C();s.update(t),e[s.constructor.name]=C()-i})),e}};class U{constructor(t,e,s){this.x=t,this.y=e,this.z=s}setX(t){this.x=t}setY(t){this.y=t}setZ(t){this.z=t}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}setScalar(t){return this.x=t,this.y=t,this.z=t,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}divideScalar(t){return this.multiplyScalar(1/t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}clone(){return new U(this.x,this.y,this.z)}distance2D(t){return Math.hypot(this.x-t.x,this.y-t.y)}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}normalise(){return this.divideScalar(this.length())}set(t){this.x=t.x,this.y=t.y,this.z=t.z}toString(){return`${x} ${y} ${z}`}}const j=[{radius:1,timer:3e3},{radius:2,timer:3e3},{radius:3,timer:3e3},{radius:4,timer:3e3},{radius:5,timer:3e3},{radius:6,timer:3e3}],O=(t,e,s)=>Math.max(e,Math.min(s,t)),T=2*Math.PI;console.log(O(1,0,2));const q=(t,e)=>({load:()=>{t.create().add(new Q("Start",e.width/2,e.height/2,()=>{window.currentScreen.unload(),window.currentScreen=X(t,e)}))},unload:()=>{t.select(Q).iterate(t=>{t.eject()})}}),X=(t,e)=>{t.create().add(new it(3,3e3)),t.create().add(new W($),new F(10,5,0),new R(0,0,0),new Y(0,0,0),new B,new K,new tt(-.5,-.5,.5,.5)),t.create().add(new N(t),new F(1,5,0)),t.create().add(new V,new B);const s=[0,0,19,0,0,9,19,9,5,5,6,5,7,5,8,5,5,6,5,7,5,8];for(let e=0;e<s.length;e+=2)t.create().add(new et(s[e],s[e+1]))};class F extends U{}class R extends U{}class Y extends U{}class N{constructor(t){this.cd=3e3,this.maxHostiles=3;for(let e=0;e<this.maxHostiles;e++)t.create().add(new J,new F(0,0,0),new W(I),new tt(-.5,-.5,.5,.5))}}class B{constructor(){this.isUp=!1,this.isLeft=!1,this.isRight=!1,this.isDown=!1,this.isMain=!1,window.addEventListener("keydown",t=>{90!==t.keyCode&&87!==t.keyCode||(this.isUp=!0),32===t.keyCode&&(this.isMain=!0),81!==t.keyCode&&65!==t.keyCode||(this.isLeft=!0),68===t.keyCode&&(this.isRight=!0),83===t.keyCode&&(this.isDown=!0)}),window.addEventListener("keyup",t=>{90!==t.keyCode&&87!==t.keyCode||(this.isUp=!1),32===t.keyCode&&(this.isMain=!1),81!==t.keyCode&&65!==t.keyCode||(this.isLeft=!1),68===t.keyCode&&(this.isRight=!1),83===t.keyCode&&(this.isDown=!1)})}}class V{constructor(){this.isUpPressed=!1,this.isDownPressed=!1}}class H{constructor(t,e){this.timer=t,this.radius=e}}const $=0,I=2;class W{constructor(t){this.draw=(e,s,i)=>{e.fillStyle="#134",t===$?(e.beginPath(),e.arc(s.x,s.y,1*i/2,0,T),e.fill(),e.closePath()):t===I?(e.beginPath(),e.arc(s.x,s.y,.5*i/4,0,T),e.closePath(),e.fill()):(e.stroke(),e.fillRect(s.x-8,s.y-8,16,16))}}}class G{constructor(t){this.diedAt=t}}class J{constructor(t,e){this.target=t,this.isActive=!1,this.type=e,this.isAttacking=!1}}class Z{constructor(t,e){this.hostile=t,this.at=e}}class K{}class Q{constructor(t,e,s,i){this.text=t,this.x=e,this.y=s,this.add=t=>{Math.abs(t.pageX-e)<100&&Math.abs(t.pageY-s)<100&&i()},window.addEventListener("mousedown",this.add)}destructor(){window.removeEventListener("mousedown",this.add)}}class tt{constructor(t,e,s,i){this.xMin=t,this.yMin=e,this.xMax=s,this.yMax=i}}class et extends U{}class st{constructor(t){this.cd=t,this.isAvailable=!0,this.isDisabled=!1,this.roll(),this.bomb=null}use(){const t=j[this.type];return this.bomb=new H(t.timer,t.radius),this.isAvailable=!1,this.bomb}roll(){this.type=Math.floor(6*Math.random()),this.isAvailable=!0}}class it{constructor(t,e){this.maxSize=t,this.disabled=0,this.bombSlots=[];for(let s=0;s<t;s++)this.bombSlots.push(new st(e))}isAvailable(){for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isAvailable&&!this.bombSlots[t].isDisabled)return!0;return!1}isAllExploded(){for(let t=0;t<this.bombSlots.length;t++)if(!this.bombSlots[t].bomb)return!1;for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].bomb.timer>0)return!1;return!0}useBomb(){for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isAvailable&&!this.bombSlots[t].isDisabled)return this.bombSlots[t].use()}roll(){for(let t=0;t<this.bombSlots.length;t++)this.bombSlots[t].isDisabled||this.bombSlots[t].roll()}disable(t,e){this.disabled++,this.disabled===this.maxSize&&(window.currentScreen=((t,e)=>{t.create().add(new Q("You died",e.width/2,e.height/2,()=>{}))})(t,e));for(let t=0;t<this.bombSlots.length;t++)if(!this.bombSlots[t].isDisabled)return void(this.bombSlots[t].isDisabled=!0)}enable(){this.disabled--;for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isDisabled)return void(this.bombSlots[t].isDisabled=!1)}}class nt{constructor(t){this.at=t}}document.body.appendChild(document.createElement("canvas"));const rt=document.querySelector("canvas");rt.width=window.innerWidth,rt.height=window.innerHeight;const ot=Math.min(rt.width/20,rt.height/10),at=rt.getContext("2d");L.register(F,R,Y,B,V,W,H,K,J,N,Q,et,tt,G,it,Z,nt),L.process(((t,e,s)=>{const i=t.select(F,W),n=t.select(et);return{update:t=>{i.iterate(t=>{const i=t.get(F);t.get(W).draw(e,i.clone().multiplyScalar(s),s)}),n.iterate(t=>{const i=t.get(et);e.fillRect(i.x*s,i.y*s,s,s)})}}})(L,at,ot),(t=>{const e=t.select(F,B),s=t.select(V,B),i=t.select(it);let n=!0;return{update:r=>{s.iterate(t=>{const{isUp:e,isDown:s}=t.get(B);e&&(t.get(V).isUpPressed=!0),s&&(t.get(V).isDownPressed=!0)}),e.iterate(e=>{const{isUp:s,isDown:r,isLeft:o,isRight:a,isMain:h}=e.get(B),c=e.get(F),l=e.get(R),d=e.get(Y);d.setScalar(0),s?d.setY(-.01):l.y<0&&!r&&l.setY(O(.02+l.y,-Number.MAX_VALUE,0)),r?d.setY(.01):l.y>0&&!s&&l.setY(O(-.02+l.y,0,Number.MAX_VALUE)),o?d.setX(-.01):l.x<0&&!a&&l.setX(O(.02+l.x,-Number.MAX_VALUE,0)),a?d.setX(.01):l.x>0&&!o&&l.setX(O(-.02+l.x,0,Number.MAX_VALUE)),l.add(d).clampScalar(-.3,.3),c.add(l),h||n||(n=!0),h&&n&&(n=!1,i.iterate(e=>{const s=e.get(it);if(s.isAvailable()){const e=s.useBomb();t.create().add(e,new F(c.x,c.y,0),new W(1))}}))})}}})(L),((t,e)=>{const s=t.select(V);return{update:t=>{s.iterate(t=>{t.get(V).isUpPressed||t.get(V).isUpPressed?t.get(V).isDownPressed&&t.get(V).isUpPressed?e.fillText("Good Dog !",10,50):t.get(V).isUpPressed&&e.fillText("Press DOWN",10,50):e.fillText("Press Up",10,50)})}}})(L,at),((t,e,s)=>{const i=t.select(H),n=t.select(J,F);return{update:r=>{i.iterate(i=>{const o=i.get(H),a=i.get(F);o.timer-=r;const h=a.x*s,c=a.y*s;e.beginPath(),e.arc(h,c,o.radius*s,0,T),e.closePath(),e.stroke(),e.fillText(Math.ceil(o.timer/1e3),h,c-20),o.timer<0&&(i.eject(),n.iterate(e=>{const s=e.get(F),i=e.get(J);s.distance2D(a)<o.radius&&(i.isActive=!1,t.create().add(new G(performance.now()),new F(s.x,s.y,s.z)))}))})}}})(L,at,ot),(t=>{const e=t.select(N),s=t.select(J);return{update:t=>{e.iterate(e=>{const i=e.get(F),n=e.get(N);if(n.cd-=t,n.cd<0){n.cd=3e3;let t=!1;s.iterate(e=>{const s=e.get(J);if(!s.isActive&&!t){s.isActive=!0;e.get(F).set(i),t=!0}})}})}}})(L),(t=>{const e=t.select(F,J),s=t.select(F,K);return{update:i=>{s.iterate(s=>{const i=s.get(F);e.iterate(e=>{const s=e.get(J);if(s.isActive){const n=e.get(F);if(!s.isAttacking){const t=i.clone().sub(n).normalise().multiplyScalar(.1);n.add(t)}i.distance2D(n)<1&&!s.isAttacking&&(s.isAttacking=!0,t.create().add(new Z(s,performance.now()),new F(n.x,n.y,n.z)))}})})}}})(L),((t,e)=>{const s=t.select(Q);return{update:()=>{s.iterate(t=>{const s=t.get(Q);e.fillText(s.text,s.x,s.y)})}}})(L,at),(t=>{const e=t.select(tt,R,F),s=t.select(et);return{update:()=>{e.iterate(t=>{const e=t.get(F),i=t.get(R),n=t.get(tt);e.x+n.xMin<0&&(e.x=-n.xMin,i.x=-i.x),e.y+n.yMin<0&&(e.y=-n.yMin,i.y=-i.y),e.x-n.xMax>19&&(e.x=19+n.xMax,i.x=-i.x),e.y-n.yMax>9&&(e.y=9+n.yMax,i.y=-i.y),s.iterate(t=>{const s=t.get(et),r=e.clone();i.x>0&&e.x+n.xMax>s.x&&e.x+n.xMax<s.x+1&&(e.y+n.yMax>s.y&&e.y+n.yMax<s.y+1||e.y+n.yMin>s.y&&e.y+n.yMin<s.y+1)&&(r.x=n.xMin+s.x+(n.xMin+s.x-r.x),i.x=-i.x),i.x<0&&e.x+n.xMin>s.x&&e.x+n.xMin<s.x+1&&(e.y+n.yMax>s.y&&e.y+n.yMax<s.y+1||e.y+n.yMin>s.y&&e.y+n.yMin<s.y+1)&&(console.log(n.xMax+s.x+1-r.x),r.x=n.xMax+s.x+1+(n.xMax+s.x+1-r.x),i.x=-i.x),i.y<0&&e.y+n.yMin>s.y&&e.y+n.yMin<s.y+1&&(e.x+n.xMin>s.x&&e.x+n.xMin<s.x+1||e.x+n.xMax>s.x&&e.x+n.xMax<s.x+1)&&(r.y=n.xMax+s.y+1+(n.xMax+s.y+1-r.y),i.y=-i.y),i.y>0&&e.y+n.xMax>s.y&&e.y+n.xMax<s.y+1&&(e.x+n.xMin>s.x&&e.x+n.xMin<s.x+1||e.x+n.xMax>s.x&&e.x+n.xMax<s.x+1)&&(r.y=n.xMin+s.y+(n.xMin+s.y-r.y),i.y=-i.y),e.set(r)})})}}})(L),((t,e,s)=>{const i=t.select(it);return{update(){i.iterate(t=>{const i=t.get(it);for(let t=1;t<=i.bombSlots.length;t++){let n=i.bombSlots[t-1];e.fillStyle=n.isDisabled?"rgba(200, 30, 30, .5)":"rgba(30, 130, 30, .5)",e.fillRect(s.width-105*t,s.height-100,100,100),e.fillText(n.isAvailable,s.width-105*t,s.height-100),e.fillText(n.type,s.width-105*t,s.height-110)}!i.isAvailable()&&i.isAllExploded()&&i.roll()})}}})(L,at,rt),((t,e,s)=>{const i=t.select(G,F);return{update:()=>{i.iterate(t=>{const i=t.get(F);t.get(G);e.fillStyle="#eee",e.beginPath(),e.arc(i.x*s,i.y*s,10,0,T),e.closePath(),e.fill()})}}})(L,at,ot),((t,e,s,i)=>{const n=t.select(Z),r=t.select(K),o=t.select(it);return{update:()=>{n.iterate(n=>{const a=n.get(Z),h=n.get(F);e.beginPath(),e.arc(h.x*s,h.y*s,2*s,0,T),e.fillStyle="rgba(200,200,200, .4)",e.closePath(),e.fill(),performance.now()-a.at>1e3&&(r.iterate(e=>{const s=e.get(F);h.distance2D(s)<2&&o.iterate(e=>{e.get(it).disable(t,i)})}),a.hostile.isAttacking=!1,n.eject(),t.create().add(new F(h.x,h.y,h.z),new nt(performance.now())))})}}})(L,at,ot,rt),((t,e,s)=>{const i=t.select(nt);return{update:t=>{i.iterate(t=>{const i=t.get(nt);if(performance.now()-i.at>300)return void t.eject();const n=t.get(F);e.beginPath(),e.fillStyle="rgba(200, 30, 30, .7)",e.arc(n.x*s,n.y*s,2*s,0,T),e.closePath(),e.fill()})}}})(L,at,ot)),window.currentScreen=q(L,rt),q(L,rt).load();let ht,ct=0;const lt=()=>{ht=performance.now(),rt.width+=0,L.update(ht-ct),ct=ht,requestAnimationFrame(lt)};lt()}]);