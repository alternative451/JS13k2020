!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t){t.exports=JSON.parse("{}")},function(t,e,i){"use strict";i.r(e);const s=Math;function n(t){return s.sin(6.283184*t)}var r=[n,function(t){return n(t)<0?-1:1},function(t){return t%1-.5},function(t){var e=t%1*4;return e<2?e-1:3-e}];function o(t){return.00390625*s.pow(1.059463094,t-128)}function a(t){return{left:new Float32Array(t),right:new Float32Array(t)}}function h(t,e,i,s){for(var n=i.fx_delay_time*s>>1,r=i.fx_delay_amt/255,o=0;o<e-n;){var a=o,h=o+n;t.left[h]+=t.right[a]*r,t.right[h]+=t.left[a]*r,o++}}function c(t,e){var i=t.createBuffer(2,e.left.length,44100);return i.getChannelData(0).set(e.left),i.getChannelData(1).set(e.right),i}var l=function(t,e,i){this.ctx=t,this.instr=e,this.rowLen=i||5605,this.osc_lfo=r[e.lfo_waveform],this.osc1=r[e.osc1_waveform],this.osc2=r[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=s.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=s.pow(2,e.lfo_freq-8)/this.rowLen};l.prototype._genSound=function(t,e,i){for(var r=0,a=0,h=o(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),c=o(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),l=this.instr.fx_resonance/255,d=0,u=0,f=e.left.length,x=this.attack+this.sustain+this.release-1;x>=0;--x){var y=x+i,m=this.osc_lfo(y*this.lfoFreq)*this.instr.lfo_amt/512+.5,p=1;x<this.attack?p=x/this.attack:x>=this.attack+this.sustain&&(p-=(x-this.attack-this.sustain)/this.release);var g=h;this.instr.lfo_osc1_freq&&(g+=m),this.instr.osc1_xenv&&(g*=p*p),r+=g;var b=this.osc1(r)*this.instr.osc1_vol;g=c,this.instr.osc2_xenv&&(g*=p*p),a+=g,b+=this.osc2(a)*this.instr.osc2_vol,this.instr.noise_fader&&(b+=(2*s.random()-1)*this.instr.noise_fader*p),b*=p/255;var w=this.instr.fx_freq;this.instr.lfo_fx_freq&&(w*=m);var v=l*(b-u)-(d+=(w=1.5*s.sin(3.141592*w/44100))*u);switch(u+=w*v,this.instr.fx_filter){case 1:b=v;break;case 2:b=d;break;case 3:b=u;break;case 4:b=d+v}g=n(y*this.panFreq)*this.instr.fx_pan_amt/512+.5,b*=.00476*this.instr.env_master,y<f&&(e.left[y]+=b*(1-g),e.right[y]+=b*g)}},l.prototype._createAudioBuffer=function(t,e){var i=this.attack+this.sustain+this.release-1+32*this.rowLen,s=a(i);this._genSound(t,s,0),h(s,i,this.instr,this.rowLen),e(c(this.ctx,s))};var d=function(t,e){this.ctx=t,this.song=e,this.waveSize=44100*e.songLen};d.prototype._generateTrack=function(t,e,i){var s=a(this.waveSize),n=this.waveSize,r=this.song.rowLen,o=this.song.endPattern,c=new l(this.ctx,t,r),d=0,u=0,f=0,x=function(){for(var e=Date.now();;)if(32!==f){if(u===o-1)return y();var i=t.p[u];if(i){var n=t.c[i-1].n[f];n&&c._genSound(n,s,d)}if(d+=r,f+=1,Date.now()-e>33)return void setTimeout(x,0)}else f=0,u+=1},y=function(){h(s,n,t,r);for(var o=0;o<n;o++)e.left[o]+=s.left[o];for(o=0;o<n;o++)e.right[o]+=s.right[o];i()};x()},d.prototype._createAudioBuffer=function(t){var e=this,i=a(this.waveSize),s=0,n=function(){s<e.song.songData.length?(s+=1,e._generateTrack(e.song.songData[s-1],i,n)):t(c(e.ctx,i))};n()};new(window.webkitAudioContext||window.AudioContext);i(0);var u=[],f=[],m={},p="_sign",g="_mask";"undefined"!=typeof Symbol&&(p=Symbol(p),g=Symbol(g));var b=function(t,e){var i=e[t];if(!i)throw new Error("The component is not registered");return i},w=b.bind(null,p),v=b.bind(null,g),M=function(t){t.id&&u.forEach((function(e){return e.match(t)}))},S=1,_={},k=function(t){this.id=t||(S++).toString(36),this.components=Object.assign({},_),this.mask=0};k.prototype.add=function(){for(var t=this,e=[],i=arguments.length;i--;)e[i]=arguments[i];e.forEach((function(e){t.components[w(e.constructor)]=e,t.mask|=v(e.constructor)})),M(this)},k.prototype.remove=function(){for(var t=this,e=[],i=arguments.length;i--;)e[i]=arguments[i];e.forEach((function(e){var i=w(e),s=t.components[i];s&&(s.destructor&&s.destructor(),delete t.components[i],t.mask&=~v(e))})),M(this)},k.prototype.has=function(t){return w(t)in this.components},k.prototype.get=function(t){return this.components[t[p]]},k.prototype.eject=function(){!function(t){var e=t.components;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=e[i];s&&s.destructor&&s.destructor()}u.forEach((function(e){return e.remove(t)})),delete m[t.id],t.id=0}(this)};var A=function(t,e){this.entity=t,this.prev=null,this.next=e},P=function(t){if(!t)throw new Error("Empty selector");for(var e in this.mask=t,this.map={},this.list=null,this.length=0,m)Object.prototype.hasOwnProperty.call(m,e)&&this.match(m[e])};P.prototype.iterate=function(t){for(var e=this.list;e;)t(e.entity),e=e.next},P.prototype.match=function(t){(this.mask&t.mask)===this.mask?this.add(t):this.remove(t)},P.prototype.add=function(t){if(!this.map[t.id]){var e=new A(t,this.list);this.list&&(this.list.prev=e),this.list=e,this.map[t.id]=e,this.length++}},P.prototype.remove=function(t){var e=this.map[t.id];e&&(e.prev?e.prev.next=e.next:this.list=e.next,e.next&&(e.next.prev=e.prev),delete this.map[t.id],this.length--)};var D=0,E=performance||Date,C=E.now.bind(E),L={register:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach((function(t){if(D>31)throw new Error("Components limit reached");if(!t[p]){var e=D.toString(36);_[e]=null,t[p]=e,t[g]=1<<D,D++}}))},process:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach((function(t){return f.push(t)}))},create:function(t){var e=new k(t);if(m[e.id])throw new Error("The ID already exist");return m[e.id]=e,e},get:function(t){return m[t]},select:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var i=0;t.forEach((function(t){i|=v(t)}));for(var s=0;s<u.length;s++)if(u[s].mask===i)return u[s];var n=new P(i);return u.push(n),n},update:function(t){var e={};return f.forEach((function(i){var s=C();i.update(t),e[i.constructor.name]=C()-s})),e}};class U{constructor(t,e,i){this.x=t,this.y=e,this.z=i}setX(t){this.x=t}setY(t){this.y=t}setZ(t){this.z=t}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}setScalar(t){return this.x=t,this.y=t,this.z=t,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}divideScalar(t){return this.multiplyScalar(1/t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}clone(){return new U(this.x,this.y,this.z)}distance2D(t){return Math.hypot(this.x-t.x,this.y-t.y)}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}normalise(){return this.divideScalar(this.length())}set(t){this.x=t.x,this.y=t.y,this.z=t.z}toString(){return`${x} ${y} ${z}`}}const j=[{radius:1,timer:3e3},{radius:2,timer:3e3},{radius:3,timer:3e3},{radius:4,timer:3e3},{radius:5,timer:3e3},{radius:6,timer:3e3}],O=(t,e,i)=>Math.max(e,Math.min(i,t)),T=2*Math.PI;console.log(O(1,0,2));const q=(t,e)=>({load:()=>{t.create().add(new Q("Start",e.width/2,e.height/2,()=>{window.currentScreen.unload(),window.currentScreen=X(t,e)}))},unload:()=>{t.select(Q).iterate(t=>{t.eject()})}}),X=(t,e)=>{t.create().add(new st(3,3e3)),t.create().add(new W($),new F(10,5,0),new R(0,0,0),new Y(0,0,0),new B,new K,new tt(-.5,-.5,.5,.5)),t.create().add(new N(t),new F(1,5,0)),t.create().add(new V,new B);const i=[0,0,19,0,0,9,19,9,5,5,6,5,7,5,8,5,5,6,5,7,5,8];for(let e=0;e<i.length;e+=2)t.create().add(new et(i[e],i[e+1]))};class F extends U{}class R extends U{}class Y extends U{}class N{constructor(t){this.cd=3e3,this.maxHostiles=3;for(let e=0;e<this.maxHostiles;e++)t.create().add(new J,new F(0,0,0),new W(I),new tt(-.5,-.5,.5,.5))}}class B{constructor(){this.isUp=!1,this.isLeft=!1,this.isRight=!1,this.isDown=!1,this.isMain=!1,window.addEventListener("keydown",t=>{90!==t.keyCode&&87!==t.keyCode||(this.isUp=!0),32===t.keyCode&&(this.isMain=!0),81!==t.keyCode&&65!==t.keyCode||(this.isLeft=!0),68===t.keyCode&&(this.isRight=!0),83===t.keyCode&&(this.isDown=!0)}),window.addEventListener("keyup",t=>{90!==t.keyCode&&87!==t.keyCode||(this.isUp=!1),32===t.keyCode&&(this.isMain=!1),81!==t.keyCode&&65!==t.keyCode||(this.isLeft=!1),68===t.keyCode&&(this.isRight=!1),83===t.keyCode&&(this.isDown=!1)})}}class V{constructor(){this.isUpPressed=!1,this.isDownPressed=!1}}class H{constructor(t,e){this.timer=t,this.radius=e}}const $=0,I=2;class W{constructor(t){this.draw=(e,i,s)=>{e.fillStyle="#134",t===$?(e.beginPath(),e.arc(i.x,i.y,1*s/2,0,T),e.fill(),e.closePath()):t===I?(e.beginPath(),e.arc(i.x,i.y,.5*s/4,0,T),e.closePath(),e.fill()):(e.stroke(),e.fillRect(i.x-8,i.y-8,16,16))}}}class G{constructor(t){this.diedAt=t}}class J{constructor(t,e){this.target=t,this.isActive=!1,this.type=e,this.isAttacking=!1}}class Z{constructor(t,e){this.hostile=t,this.at=e}}class K{}class Q{constructor(t,e,i,s){this.text=t,this.x=e,this.y=i,this.add=t=>{Math.abs(t.pageX-e)<100&&Math.abs(t.pageY-i)<100&&s()},window.addEventListener("mousedown",this.add)}destructor(){window.removeEventListener("mousedown",this.add)}}class tt{constructor(t,e,i,s){this.xMin=t,this.yMin=e,this.xMax=i,this.yMax=s}}class et extends U{}class it{constructor(t){this.cd=t,this.isAvailable=!0,this.isDisabled=!1,this.roll(),this.bomb=null}use(){const t=j[this.type];return this.bomb=new H(t.timer,t.radius),this.isAvailable=!1,this.bomb}roll(){this.type=Math.floor(6*Math.random()),this.isAvailable=!0}}class st{constructor(t,e){this.maxSize=t,this.disabled=0,this.bombSlots=[];for(let i=0;i<t;i++)this.bombSlots.push(new it(e))}isAvailable(){for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isAvailable&&!this.bombSlots[t].isDisabled)return!0;return!1}isAllExploded(){for(let t=0;t<this.bombSlots.length;t++)if(!this.bombSlots[t].bomb)return!1;for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].bomb.timer>0)return!1;return!0}useBomb(){for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isAvailable&&!this.bombSlots[t].isDisabled)return this.bombSlots[t].use()}roll(){for(let t=0;t<this.bombSlots.length;t++)this.bombSlots[t].isDisabled||this.bombSlots[t].roll()}disable(t,e){this.disabled++,this.disabled===this.maxSize&&(window.currentScreen=((t,e)=>{t.create().add(new Q("You died",e.width/2,e.height/2,()=>{}))})(t,e));for(let t=0;t<this.bombSlots.length;t++)if(!this.bombSlots[t].isDisabled)return void(this.bombSlots[t].isDisabled=!0)}enable(){this.disabled--;for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isDisabled)return void(this.bombSlots[t].isDisabled=!1)}}class nt{constructor(t){this.at=t}}document.body.appendChild(document.createElement("canvas"));const rt=document.querySelector("canvas");rt.width=window.innerWidth,rt.height=window.innerHeight;const ot=Math.min(rt.width/20,rt.height/10),at=rt.getContext("2d");L.register(F,R,Y,B,V,W,H,K,J,N,Q,et,tt,G,st,Z,nt),L.process(((t,e,i)=>{const s=t.select(F,W),n=t.select(et);return{update:t=>{s.iterate(t=>{const s=t.get(F);t.get(W).draw(e,s.clone().multiplyScalar(i),i)}),n.iterate(t=>{const s=t.get(et);e.fillRect(s.x*i,s.y*i,i,i)})}}})(L,at,ot),(t=>{const e=t.select(F,B),i=t.select(V,B),s=t.select(st);let n=!0;return{update:r=>{i.iterate(t=>{const{isUp:e,isDown:i}=t.get(B);e&&(t.get(V).isUpPressed=!0),i&&(t.get(V).isDownPressed=!0)}),e.iterate(e=>{const{isUp:i,isDown:r,isLeft:o,isRight:a,isMain:h}=e.get(B),c=e.get(F),l=e.get(R),d=e.get(Y);d.setScalar(0),i?d.setY(-.01):l.y<0&&!r&&l.setY(O(.02+l.y,-Number.MAX_VALUE,0)),r?d.setY(.01):l.y>0&&!i&&l.setY(O(-.02+l.y,0,Number.MAX_VALUE)),o?d.setX(-.01):l.x<0&&!a&&l.setX(O(.02+l.x,-Number.MAX_VALUE,0)),a?d.setX(.01):l.x>0&&!o&&l.setX(O(-.02+l.x,0,Number.MAX_VALUE)),l.add(d).clampScalar(-1/8,1/8),c.add(l),h||n||(n=!0),h&&n&&(n=!1,s.iterate(e=>{const i=e.get(st);if(i.isAvailable()){const e=i.useBomb();t.create().add(e,new F(c.x,c.y,0),new W(1))}}))})}}})(L),((t,e)=>{const i=t.select(V);return{update:t=>{i.iterate(t=>{t.get(V).isUpPressed||t.get(V).isUpPressed?t.get(V).isDownPressed&&t.get(V).isUpPressed?e.fillText("Good Dog !",10,50):t.get(V).isUpPressed&&e.fillText("Press DOWN",10,50):e.fillText("Press Up",10,50)})}}})(L,at),((t,e,i)=>{const s=t.select(H),n=t.select(J,F);return{update:r=>{s.iterate(s=>{const o=s.get(H),a=s.get(F);o.timer-=r;const h=a.x*i,c=a.y*i;e.beginPath(),e.arc(h,c,o.radius*i,0,T),e.closePath(),e.stroke(),e.fillText(Math.ceil(o.timer/1e3),h,c-20),o.timer<0&&(s.eject(),n.iterate(e=>{const i=e.get(F),s=e.get(J);i.distance2D(a)<o.radius&&(s.isActive=!1,t.create().add(new G(performance.now()),new F(i.x,i.y,i.z)))}))})}}})(L,at,ot),(t=>{const e=t.select(N),i=t.select(J);return{update:t=>{e.iterate(e=>{const s=e.get(F),n=e.get(N);if(n.cd-=t,n.cd<0){n.cd=3e3;let t=!1;i.iterate(e=>{const i=e.get(J);if(!i.isActive&&!t){i.isActive=!0;e.get(F).set(s),t=!0}})}})}}})(L),(t=>{const e=t.select(F,J),i=t.select(F,K);return{update:s=>{i.iterate(i=>{const s=i.get(F);e.iterate(e=>{const i=e.get(J);if(i.isActive){const n=e.get(F);if(!i.isAttacking){const t=s.clone().sub(n).normalise().multiplyScalar(.1);n.add(t)}s.distance2D(n)<1&&!i.isAttacking&&(i.isAttacking=!0,t.create().add(new Z(i,performance.now()),new F(n.x,n.y,n.z)))}})})}}})(L),((t,e)=>{const i=t.select(Q);return{update:()=>{i.iterate(t=>{const i=t.get(Q);e.fillText(i.text,i.x,i.y)})}}})(L,at),(t=>{const e=t.select(tt,R,F),i=t.select(et);return{update:()=>{e.iterate(t=>{const e=t.get(F),s=t.get(R),n=t.get(tt);e.x+n.xMin<0&&(e.x=-n.xMin,s.x=-s.x),e.y+n.yMin<0&&(e.y=-n.yMin,s.y=-s.y),e.x-n.xMax>19&&(e.x=19+n.xMax,s.x=-s.x),e.y-n.yMax>9&&(e.y=9+n.yMax,s.y=-s.y),i.iterate(t=>{const i=t.get(et),r=e.clone();s.x>0&&e.x+n.xMax>i.x&&e.x+n.xMax<i.x+1&&(e.y+n.yMax>i.y&&e.y+n.yMax<i.y+1||e.y+n.yMin>i.y&&e.y+n.yMin<i.y+1)&&(r.x=n.xMin+i.x+(n.xMin+i.x-r.x),s.x=-s.x),s.x<0&&e.x+n.xMin>i.x&&e.x+n.xMin<i.x+1&&(e.y+n.yMax>i.y&&e.y+n.yMax<i.y+1||e.y+n.yMin>i.y&&e.y+n.yMin<i.y+1)&&(console.log(n.xMax+i.x+1-r.x),r.x=n.xMax+i.x+1+(n.xMax+i.x+1-r.x),s.x=-s.x),s.y<0&&e.y+n.yMin>i.y&&e.y+n.yMin<i.y+1&&(e.x+n.xMin>i.x&&e.x+n.xMin<i.x+1||e.x+n.xMax>i.x&&e.x+n.xMax<i.x+1)&&(r.y=n.xMax+i.y+1+(n.xMax+i.y+1-r.y),s.y=-s.y),s.y>0&&e.y+n.xMax>i.y&&e.y+n.xMax<i.y+1&&(e.x+n.xMin>i.x&&e.x+n.xMin<i.x+1||e.x+n.xMax>i.x&&e.x+n.xMax<i.x+1)&&(r.y=n.xMin+i.y+(n.xMin+i.y-r.y),s.y=-s.y),e.set(r)})})}}})(L),((t,e,i)=>{const s=t.select(st);return{update(){s.iterate(t=>{const s=t.get(st);for(let t=1;t<=s.bombSlots.length;t++){let n=s.bombSlots[t-1];e.fillStyle=n.isDisabled?"rgba(200, 30, 30, .5)":"rgba(30, 130, 30, .5)",e.fillRect(i.width-105*t,i.height-100,100,100),e.fillStyle="#000",e.fillText(n.isAvailable,i.width-105*t,i.height-100),e.fillText(n.type,i.width-105*t,i.height-110)}!s.isAvailable()&&s.isAllExploded()&&s.roll()})}}})(L,at,rt),((t,e,i)=>{const s=t.select(G,F);return{update:()=>{s.iterate(t=>{const s=t.get(F);t.get(G);e.fillStyle="#eee",e.beginPath(),e.arc(s.x*i,s.y*i,10,0,T),e.closePath(),e.fill()})}}})(L,at,ot),((t,e,i,s)=>{const n=t.select(Z),r=t.select(K),o=t.select(st);return{update:()=>{n.iterate(n=>{const a=n.get(Z),h=n.get(F);e.beginPath(),e.arc(h.x*i,h.y*i,2*i,0,T),e.fillStyle="rgba(200,200,200, .4)",e.closePath(),e.fill(),performance.now()-a.at>500&&(r.iterate(e=>{const i=e.get(F);h.distance2D(i)<2&&o.iterate(e=>{e.get(st).disable(t,s)})}),a.hostile.isAttacking=!1,n.eject(),t.create().add(new F(h.x,h.y,h.z),new nt(performance.now())))})}}})(L,at,ot,rt),((t,e,i)=>{const s=t.select(nt);return{update:t=>{s.iterate(t=>{const s=t.get(nt);if(performance.now()-s.at>300)return void t.eject();const n=t.get(F);e.beginPath(),e.fillStyle="rgba(200, 30, 30, .7)",e.arc(n.x*i,n.y*i,2*i,0,T),e.closePath(),e.fill()})}}})(L,at,ot)),window.currentScreen=q(L,rt),q(L,rt).load();let ht,ct=0;const lt=()=>{ht=performance.now(),rt.width+=0,L.update(ht-ct),ct=ht,requestAnimationFrame(lt)};lt()}]);