!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t){t.exports=JSON.parse("{}")},function(t,e,s){"use strict";s.r(e);const i=Math;function n(t){return i.sin(6.283184*t)}var r=[n,function(t){return n(t)<0?-1:1},function(t){return t%1-.5},function(t){var e=t%1*4;return e<2?e-1:3-e}];function o(t){return.00390625*i.pow(1.059463094,t-128)}function a(t){return{left:new Float32Array(t),right:new Float32Array(t)}}function c(t,e,s,i){for(var n=s.fx_delay_time*i>>1,r=s.fx_delay_amt/255,o=0;o<e-n;){var a=o,c=o+n;t.left[c]+=t.right[a]*r,t.right[c]+=t.left[a]*r,o++}}function h(t,e){var s=t.createBuffer(2,e.left.length,44100);return s.getChannelData(0).set(e.left),s.getChannelData(1).set(e.right),s}var u=function(t,e,s){this.ctx=t,this.instr=e,this.rowLen=s||5605,this.osc_lfo=r[e.lfo_waveform],this.osc1=r[e.osc1_waveform],this.osc2=r[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=i.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=i.pow(2,e.lfo_freq-8)/this.rowLen};u.prototype._genSound=function(t,e,s){for(var r=0,a=0,c=o(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),h=o(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),u=this.instr.fx_resonance/255,l=0,d=0,f=e.left.length,p=this.attack+this.sustain+this.release-1;p>=0;--p){var y=p+s,x=this.osc_lfo(y*this.lfoFreq)*this.instr.lfo_amt/512+.5,m=1;p<this.attack?m=p/this.attack:p>=this.attack+this.sustain&&(m-=(p-this.attack-this.sustain)/this.release);var w=c;this.instr.lfo_osc1_freq&&(w+=x),this.instr.osc1_xenv&&(w*=m*m),r+=w;var g=this.osc1(r)*this.instr.osc1_vol;w=h,this.instr.osc2_xenv&&(w*=m*m),a+=w,g+=this.osc2(a)*this.instr.osc2_vol,this.instr.noise_fader&&(g+=(2*i.random()-1)*this.instr.noise_fader*m),g*=m/255;var v=this.instr.fx_freq;this.instr.lfo_fx_freq&&(v*=x);var _=u*(g-d)-(l+=(v=1.5*i.sin(3.141592*v/44100))*d);switch(d+=v*_,this.instr.fx_filter){case 1:g=_;break;case 2:g=l;break;case 3:g=d;break;case 4:g=l+_}w=n(y*this.panFreq)*this.instr.fx_pan_amt/512+.5,g*=.00476*this.instr.env_master,y<f&&(e.left[y]+=g*(1-w),e.right[y]+=g*w)}},u.prototype._createAudioBuffer=function(t,e){var s=this.attack+this.sustain+this.release-1+32*this.rowLen,i=a(s);this._genSound(t,i,0),c(i,s,this.instr,this.rowLen),e(h(this.ctx,i))};var l=function(t,e){this.ctx=t,this.song=e,this.waveSize=44100*e.songLen};l.prototype._generateTrack=function(t,e,s){var i=a(this.waveSize),n=this.waveSize,r=this.song.rowLen,o=this.song.endPattern,h=new u(this.ctx,t,r),l=0,d=0,f=0,p=function(){for(var e=Date.now();;)if(32!==f){if(d===o-1)return y();var s=t.p[d];if(s){var n=t.c[s-1].n[f];n&&h._genSound(n,i,l)}if(l+=r,f+=1,Date.now()-e>33)return void setTimeout(p,0)}else f=0,d+=1},y=function(){c(i,n,t,r);for(var o=0;o<n;o++)e.left[o]+=i.left[o];for(o=0;o<n;o++)e.right[o]+=i.right[o];s()};p()},l.prototype._createAudioBuffer=function(t){var e=this,s=a(this.waveSize),i=0,n=function(){i<e.song.songData.length?(i+=1,e._generateTrack(e.song.songData[i-1],s,n)):t(h(e.ctx,s))};n()};new(window.webkitAudioContext||window.AudioContext);s(0);var d=[],f=[],p={},m="_sign",w="_mask";"undefined"!=typeof Symbol&&(m=Symbol(m),w=Symbol(w));var g=function(t,e){var s=e[t];if(!s)throw new Error("The component is not registered");return s},v=g.bind(null,m),_=g.bind(null,w),M=function(t){t.id&&d.forEach((function(e){return e.match(t)}))},k=1,b={},S=function(t){this.id=t||(k++).toString(36),this.components=Object.assign({},b),this.mask=0};S.prototype.add=function(){for(var t=this,e=[],s=arguments.length;s--;)e[s]=arguments[s];e.forEach((function(e){t.components[v(e.constructor)]=e,t.mask|=_(e.constructor)})),M(this)},S.prototype.remove=function(){for(var t=this,e=[],s=arguments.length;s--;)e[s]=arguments[s];e.forEach((function(e){var s=v(e),i=t.components[s];i&&(i.destructor&&i.destructor(),delete t.components[s],t.mask&=~_(e))})),M(this)},S.prototype.has=function(t){return v(t)in this.components},S.prototype.get=function(t){return this.components[t[m]]},S.prototype.eject=function(){!function(t){var e=t.components;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var i=e[s];i&&i.destructor&&i.destructor()}d.forEach((function(e){return e.remove(t)})),delete p[t.id],t.id=0}(this)};var P=function(t,e){this.entity=t,this.prev=null,this.next=e},C=function(t){if(!t)throw new Error("Empty selector");for(var e in this.mask=t,this.map={},this.list=null,this.length=0,p)Object.prototype.hasOwnProperty.call(p,e)&&this.match(p[e])};C.prototype.iterate=function(t){for(var e=this.list;e;)t(e.entity),e=e.next},C.prototype.match=function(t){(this.mask&t.mask)===this.mask?this.add(t):this.remove(t)},C.prototype.add=function(t){if(!this.map[t.id]){var e=new P(t,this.list);this.list&&(this.list.prev=e),this.list=e,this.map[t.id]=e,this.length++}},C.prototype.remove=function(t){var e=this.map[t.id];e&&(e.prev?e.prev.next=e.next:this.list=e.next,e.next&&(e.next.prev=e.prev),delete this.map[t.id],this.length--)};var E=0,D=performance||Date,L=D.now.bind(D),U={register:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach((function(t){if(E>31)throw new Error("Components limit reached");if(!t[m]){var e=E.toString(36);b[e]=null,t[m]=e,t[w]=1<<E,E++}}))},process:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach((function(t){return f.push(t)}))},create:function(t){var e=new S(t);if(p[e.id])throw new Error("The ID already exist");return p[e.id]=e,e},get:function(t){return p[t]},select:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var s=0;t.forEach((function(t){s|=_(t)}));for(var i=0;i<d.length;i++)if(d[i].mask===s)return d[i];var n=new C(s);return d.push(n),n},update:function(t){var e={};return f.forEach((function(s){var i=L();s.update(t),e[s.constructor.name]=L()-i})),e}};class A{constructor(t,e,s){this.x=t,this.y=e,this.z=s}setX(t){this.x=t}setY(t){this.y=t}setZ(t){this.z=t}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}setScalar(t){return this.x=t,this.y=t,this.z=t,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}divideScalar(t){return this.multiplyScalar(1/t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}clone(){return new A(this.x,this.y,this.z)}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}normalise(){return this.divideScalar(this.length())}toString(){return`${x} ${y} ${z}`}}class O extends A{}class j extends A{}class q extends A{}class T{constructor(){this.cd=3e3,this.maxHostiles=3}}const X=2*Math.PI;class F{constructor(){this.isUp=!1,this.isLeft=!1,this.isRight=!1,this.isDown=!1,this.isMain=!1,window.addEventListener("keydown",t=>{90!==t.keyCode&&87!==t.keyCode||(this.isUp=!0),32===t.keyCode&&(this.isMain=!0),81!==t.keyCode&&65!==t.keyCode||(this.isLeft=!0),68===t.keyCode&&(this.isRight=!0),83===t.keyCode&&(this.isDown=!0)}),window.addEventListener("keyup",t=>{90!==t.keyCode&&87!==t.keyCode||(this.isUp=!1),32===t.keyCode&&(this.isMain=!1),81!==t.keyCode&&65!==t.keyCode||(this.isLeft=!1),68===t.keyCode&&(this.isRight=!1),83===t.keyCode&&(this.isDown=!1)})}}class N{constructor(){this.isUpPressed=!1,this.isDownPressed=!1}}class R{constructor(t){this.timer=t}}class Y{constructor(t){this.draw=(e,s,i)=>{e.fillStyle="#134",0===t?(e.beginPath(),e.arc(s.x,s.y,1*i/2,0,X),e.fill(),e.closePath()):2===t?(e.beginPath(),e.arc(s.x,s.y,.5*i/4,0,X),e.closePath(),e.fill()):e.fillRect(s.x-8,s.y-8,16,16)}}}class H{constructor(t){this.target=t}}class V{}class B{constructor(t,e,s,i){this.text=t,this.x=e,this.y=s,window.addEventListener("mousedown",t=>{Math.abs(t.pageX-e)<100&&Math.abs(t.pageY-s)<100&&i()})}}class ${constructor(t,e,s,i){this.xMin=t,this.yMin=e,this.xMax=s,this.yMax=i}}class I extends A{}const W=(t,e,s)=>Math.max(e,Math.min(s,t));console.log(W(1,0,2));const G=(t,e)=>({load:()=>{t.create().add(new B("Start",e.width/2,e.height/2,()=>{window.currentScreen.unload(),window.currentScreen=J(t,e)}))},unload:()=>{t.select(B).iterate(t=>{t.eject()})}}),J=(t,e)=>{t.create().add(new Y(0),new O(10,5,0),new j(0,0,0),new q(0,0,0),new F,new V,new $(-.5,-.5,.5,.5)),t.create().add(new T,new O(1,5,0)),t.create().add(new N,new F);const s=[0,0,19,0,0,9,19,9];for(let e=0;e<s.length;e+=2)t.create().add(new I(s[e],s[e+1]))};document.body.appendChild(document.createElement("canvas"));const Z=document.querySelector("canvas");Z.width=window.innerWidth,Z.height=window.innerHeight;const K=Math.min(Z.width/20,Z.height/10),Q=Z.getContext("2d");U.register(O,j,q,F,N,Y,R,V,H,T,B,I,$),U.process(((t,e,s)=>{const i=t.select(O,Y),n=t.select(I);return{update:t=>{i.iterate(t=>{const i=t.get(O);t.get(Y).draw(e,i.clone().multiplyScalar(s),s)}),n.iterate(t=>{const i=t.get(I);e.fillRect(i.x*s,i.y*s,s,s)})}}})(U,Q,K),(t=>{const e=t.select(O,F),s=t.select(N,F);return{update:i=>{s.iterate(t=>{const{isUp:e,isDown:s}=t.get(F);e&&(t.get(N).isUpPressed=!0),s&&(t.get(N).isDownPressed=!0)}),e.iterate(e=>{const{isUp:s,isDown:i,isLeft:n,isRight:r,isMain:o}=e.get(F),a=e.get(O),c=e.get(j),h=e.get(q);h.setScalar(0),s?h.setY(-.01):c.y<0&&!i&&c.setY(W(.02+c.y,-Number.MAX_VALUE,0)),i?h.setY(.01):c.y>0&&!s&&c.setY(W(-.02+c.y,0,Number.MAX_VALUE)),n?h.setX(-.01):c.x<0&&!r&&c.setX(W(.02+c.x,-Number.MAX_VALUE,0)),r?h.setX(.01):c.x>0&&!n&&c.setX(W(-.02+c.x,0,Number.MAX_VALUE)),c.add(h).clampScalar(-.3,.3),a.add(c),o&&t.create().add(new R(3e3),new O(a.x,a.y,0),new Y(1))})}}})(U),((t,e)=>{const s=t.select(N);return{update:t=>{s.iterate(t=>{t.get(N).isUpPressed||t.get(N).isUpPressed?t.get(N).isDownPressed&&t.get(N).isUpPressed?e.fillText("Good Dog !",10,50):t.get(N).isUpPressed&&e.fillText("Press DOWN",10,50):e.fillText("Press Up",10,50)})}}})(U,Q),(t=>{const e=t.select(R),s=t.select(H,O);return{update:t=>{e.iterate(e=>{const i=e.get(R);i.timer-=t,i.timer<0&&(e.eject(),s.iterate(t=>{}))})}}})(U),(t=>{const e=t.select(T);return{update:s=>{e.iterate(e=>{const i=e.get(O),n=e.get(T);n.cd-=s,n.cd<0&&n.maxHostiles>0&&(n.maxHostiles--,n.cd=3e3,t.create().add(new H,new O(i.x,i.y,i.z),new Y(2)))})}}})(U),(t=>{const e=t.select(O,H),s=t.select(O,V);return{update:t=>{s.iterate(t=>{const s=t.get(O);e.iterate(t=>{const e=t.get(O),i=s.clone().sub(t.get(O)).normalise().multiplyScalar(.1);e.add(i)})})}}})(U),((t,e)=>{const s=t.select(B);return{update:()=>{s.iterate(t=>{const s=t.get(B);e.fillText(s.text,s.x,s.y)})}}})(U,Q),(t=>{const e=t.select($),s=t.select(I);return{update:()=>{e.iterate(t=>{const e=t.get(O),i=t.get($);e.x+i.xMin<0&&(e.x=-i.xMin),e.y+i.yMin<0&&(e.y=-i.yMin),e.x-i.xMax>20&&(e.x=20+i.xMax),e.y-i.yMax>10&&(e.y=10+i.yMax),s.iterate(t=>{})})}}})(U)),window.currentScreen=G(U,Z),G(U,Z).load();let tt,et=0;const st=()=>{tt=performance.now(),Z.width+=0,U.update(tt-et),et=tt,requestAnimationFrame(st)};st()}]);