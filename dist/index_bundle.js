!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t){t.exports=JSON.parse('{"height":10,"layers":[{"objects":[{"text":"Bonjour Monde","width":18.0958333333333,"x":3.87148696985179,"y":1.97802759325498},{"properties":[{"name":"isStart","value":true}],"x":1,"y":6},{"height":4,"properties":[{"name":"isDoor","type":"bool","value":true}],"width":1,"x":19,"y":3}]},{"data":[0,0,0,0,0,0,0,0,0,0,84047,84047,84047,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,84047,84047,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,84047,84047,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,90448,90448,0,0,0,0,0,0,0,0,0,88049,88049,0,0,0,0,0,0,0,90448,90448,0,0,0,0,0,0,0,0,0,88049,88049,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"height":10,"width":20,"x":0,"y":0}],"version":1.4,"width":20}')},function(t){t.exports=JSON.parse('{"compressionlevel":-1,"height":10,"infinite":false,"layers":[{"draworder":"topdown","id":2,"name":"Calque d\'Objets 1","objects":[{"height":0,"id":1,"name":"","point":true,"properties":[{"name":"isSpawn","type":"bool","value":true},{"name":"total","type":"int","value":7},{"name":"max","type":"int","value":3}],"rotation":0,"type":"","visible":true,"width":0,"x":10,"y":5}],"opacity":1,"type":"objectgroup","visible":true,"x":0,"y":0},{"data":[0,0,0,0,0,86450,86450,86450,86450,86450,0,0,0,0,0,0,86450,0,0,0,0,0,0,0,0,0,0,0,0,86450,0,0,0,0,0,0,86450,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86450,0,0,0,0,0,0,0,0,0,0,86450,0,0,0,0,0,0,0,0,86450,0,0,0,0,86450,0,0,0,0,0,86450,0,0,0,0,0,0,0,0,86450,0,0,0,0,86450,0,0,0,0,0,86450,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86450,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,86450,0,0,0,0,0,0,86450,0,0,0,0,0,0,0,0,86450,86450,86450,86450,86450,0,0,0,0,0,0,86450,0,0,0],"height":10,"id":1,"name":"Calque de Tuiles 1","opacity":1,"type":"tilelayer","visible":true,"width":20,"x":0,"y":0}],"nextlayerid":3,"nextobjectid":2,"orientation":"orthogonal","renderorder":"left-up","tiledversion":"1.4.1","tileheight":1,"tilesets":[{"firstgid":1,"source":"aos.tsx"}],"tilewidth":1,"type":"map","version":1.4,"width":20}')},function(t){t.exports=JSON.parse("{}")},function(t,e,i){"use strict";i.r(e);const s=Math;function n(t){return s.sin(6.283184*t)}var r=[n,function(t){return n(t)<0?-1:1},function(t){return t%1-.5},function(t){var e=t%1*4;return e<2?e-1:3-e}];function o(t){return.00390625*s.pow(1.059463094,t-128)}function a(t){return{left:new Float32Array(t),right:new Float32Array(t)}}function l(t,e,i,s){for(var n=i.fx_delay_time*s>>1,r=i.fx_delay_amt/255,o=0;o<e-n;){var a=o,l=o+n;t.left[l]+=t.right[a]*r,t.right[l]+=t.left[a]*r,o++}}function c(t,e){var i=t.createBuffer(2,e.left.length,44100);return i.getChannelData(0).set(e.left),i.getChannelData(1).set(e.right),i}var h=function(t,e,i){this.ctx=t,this.instr=e,this.rowLen=i||5605,this.osc_lfo=r[e.lfo_waveform],this.osc1=r[e.osc1_waveform],this.osc2=r[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=s.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=s.pow(2,e.lfo_freq-8)/this.rowLen};h.prototype._genSound=function(t,e,i){for(var r=0,a=0,l=o(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),c=o(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),h=this.instr.fx_resonance/255,d=0,u=0,y=e.left.length,x=this.attack+this.sustain+this.release-1;x>=0;--x){var f=x+i,p=this.osc_lfo(f*this.lfoFreq)*this.instr.lfo_amt/512+.5,m=1;x<this.attack?m=x/this.attack:x>=this.attack+this.sustain&&(m-=(x-this.attack-this.sustain)/this.release);var w=l;this.instr.lfo_osc1_freq&&(w+=p),this.instr.osc1_xenv&&(w*=m*m),r+=w;var g=this.osc1(r)*this.instr.osc1_vol;w=c,this.instr.osc2_xenv&&(w*=m*m),a+=w,g+=this.osc2(a)*this.instr.osc2_vol,this.instr.noise_fader&&(g+=(2*s.random()-1)*this.instr.noise_fader*m),g*=m/255;var b=this.instr.fx_freq;this.instr.lfo_fx_freq&&(b*=p);var v=h*(g-u)-(d+=(b=1.5*s.sin(3.141592*b/44100))*u);switch(u+=b*v,this.instr.fx_filter){case 1:g=v;break;case 2:g=d;break;case 3:g=u;break;case 4:g=d+v}w=n(f*this.panFreq)*this.instr.fx_pan_amt/512+.5,g*=.00476*this.instr.env_master,f<y&&(e.left[f]+=g*(1-w),e.right[f]+=g*w)}},h.prototype._createAudioBuffer=function(t,e){var i=this.attack+this.sustain+this.release-1+32*this.rowLen,s=a(i);this._genSound(t,s,0),l(s,i,this.instr,this.rowLen),e(c(this.ctx,s))};var d=function(t,e){this.ctx=t,this.song=e,this.waveSize=44100*e.songLen};d.prototype._generateTrack=function(t,e,i){var s=a(this.waveSize),n=this.waveSize,r=this.song.rowLen,o=this.song.endPattern,c=new h(this.ctx,t,r),d=0,u=0,y=0,x=function(){for(var e=Date.now();;)if(32!==y){if(u===o-1)return f();var i=t.p[u];if(i){var n=t.c[i-1].n[y];n&&c._genSound(n,s,d)}if(d+=r,y+=1,Date.now()-e>33)return void setTimeout(x,0)}else y=0,u+=1},f=function(){l(s,n,t,r);for(var o=0;o<n;o++)e.left[o]+=s.left[o];for(o=0;o<n;o++)e.right[o]+=s.right[o];i()};x()},d.prototype._createAudioBuffer=function(t){var e=this,i=a(this.waveSize),s=0,n=function(){s<e.song.songData.length?(s+=1,e._generateTrack(e.song.songData[s-1],i,n)):t(c(e.ctx,i))};n()};new(window.webkitAudioContext||window.AudioContext);i(2);var u=[],f=[],p={},m="_sign",w="_mask";"undefined"!=typeof Symbol&&(m=Symbol(m),w=Symbol(w));var g=function(t,e){var i=e[t];if(!i)throw new Error("The component is not registered");return i},b=g.bind(null,m),v=g.bind(null,w),S=function(t){t.id&&u.forEach((function(e){return e.match(t)}))},M=1,_={},k=function(t){this.id=t||(M++).toString(36),this.components=Object.assign({},_),this.mask=0};k.prototype.add=function(){for(var t=this,e=[],i=arguments.length;i--;)e[i]=arguments[i];e.forEach((function(e){t.components[b(e.constructor)]=e,t.mask|=v(e.constructor)})),S(this)},k.prototype.remove=function(){for(var t=this,e=[],i=arguments.length;i--;)e[i]=arguments[i];e.forEach((function(e){var i=b(e),s=t.components[i];s&&(s.destructor&&s.destructor(),delete t.components[i],t.mask&=~v(e))})),S(this)},k.prototype.has=function(t){return b(t)in this.components},k.prototype.get=function(t){return this.components[t[m]]},k.prototype.eject=function(){!function(t){var e=t.components;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=e[i];s&&s.destructor&&s.destructor()}u.forEach((function(e){return e.remove(t)})),delete p[t.id],t.id=0}(this)};var A=function(t,e){this.entity=t,this.prev=null,this.next=e},D=function(t){if(!t)throw new Error("Empty selector");for(var e in this.mask=t,this.map={},this.list=null,this.length=0,p)Object.prototype.hasOwnProperty.call(p,e)&&this.match(p[e])};D.prototype.iterate=function(t){for(var e=this.list;e;)t(e.entity),e=e.next},D.prototype.match=function(t){(this.mask&t.mask)===this.mask?this.add(t):this.remove(t)},D.prototype.add=function(t){if(!this.map[t.id]){var e=new A(t,this.list);this.list&&(this.list.prev=e),this.list=e,this.map[t.id]=e,this.length++}},D.prototype.remove=function(t){var e=this.map[t.id];e&&(e.prev?e.prev.next=e.next:this.list=e.next,e.next&&(e.next.prev=e.prev),delete this.map[t.id],this.length--)};var E=0,L=performance||Date,P=L.now.bind(L),j={register:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach((function(t){if(E>31)throw new Error("Components limit reached");if(!t[m]){var e=E.toString(36);_[e]=null,t[m]=e,t[w]=1<<E,E++}}))},process:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach((function(t){return f.push(t)}))},create:function(t){var e=new k(t);if(p[e.id])throw new Error("The ID already exist");return p[e.id]=e,e},get:function(t){return p[t]},select:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var i=0;t.forEach((function(t){i|=v(t)}));for(var s=0;s<u.length;s++)if(u[s].mask===i)return u[s];var n=new D(i);return u.push(n),n},update:function(t){var e={};return f.forEach((function(i){var s=P();i.update(t),e[i.constructor.name]=P()-s})),e}};class C{constructor(t,e,i){this.x=t,this.y=e,this.z=i}setX(t){this.x=t}setY(t){this.y=t}setZ(t){this.z=t}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}dot2D(t){return this.x*t.x+this.y*t.y}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}setScalar(t){return this.x=t,this.y=t,this.z=t,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}clone(){return new C(this.x,this.y,this.z)}distance2D(t){return Math.hypot(this.x-t.x,this.y-t.y)}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}normalise(){return this.divideScalar(this.length())}set(t){this.x=t.x,this.y=t.y,this.z=t.z}toString(){return`${x} ${y} ${z}`}}const O=[{radius:1,timer:3e3},{radius:2,timer:3e3},{radius:3,timer:3e3},{radius:4,timer:3e3},{radius:5,timer:3e3},{radius:6,timer:3e3}],q=(t,e,i)=>Math.max(e,Math.min(i,t)),R=2*Math.PI;class T extends C{}class U extends C{}class X extends C{}class F{constructor(t,e,i){this.cd=3e3,this.maxHostiles=e,this.total=i;for(let e=0;e<this.maxHostiles;e++)t.create().add(new W,new T(0,0,0),new I(V),new U(0,0,0),new K(-.5,-.5,.5,.5))}}class N{constructor(){this.isUp=!1,this.isLeft=!1,this.isRight=!1,this.isDown=!1,this.isMain=!1,window.addEventListener("keydown",t=>{90!==t.keyCode&&87!==t.keyCode||(this.isUp=!0),32===t.keyCode&&(this.isMain=!0),81!==t.keyCode&&65!==t.keyCode||(this.isLeft=!0),68===t.keyCode&&(this.isRight=!0),83===t.keyCode&&(this.isDown=!0)}),window.addEventListener("keyup",t=>{90!==t.keyCode&&87!==t.keyCode||(this.isUp=!1),32===t.keyCode&&(this.isMain=!1),81!==t.keyCode&&65!==t.keyCode||(this.isLeft=!1),68===t.keyCode&&(this.isRight=!1),83===t.keyCode&&(this.isDown=!1)})}}class Y{constructor(t){this.sc=t}}class B{constructor(t,e){this.timer=t,this.radius=e}}const H=0,V=2;class I{constructor(t){this.draw=(e,i,s)=>{e.fillStyle="rgba(13, 53, 72, .8)",t===H?(e.beginPath(),e.arc(i.x,i.y,1*s/2,0,R),e.fill(),e.closePath()):t===V?(e.beginPath(),e.arc(i.x,i.y,.5*s/4,0,R),e.closePath(),e.fill()):(e.stroke(),e.fillRect(i.x-8,i.y-8,16,16))}}}class J{constructor(t){this.diedAt=t}}class W{constructor(t,e){this.target=t,this.isActive=!1,this.type=e,this.isAttacking=!1}}class ${constructor(t,e){this.hostile=t,this.at=e}}class Z{constructor(){this.hp=100}}class G{constructor(t,e,i,s){this.text=t,this.x=e,this.y=i,this.add=t=>{Math.abs(t.pageX-e)<100&&Math.abs(t.pageY-i)<100&&s()},window.addEventListener("mousedown",this.add)}destructor(){window.removeEventListener("mousedown",this.add)}}class K{constructor(t,e,i,s){this.xMin=t,this.yMin=e,this.xMax=i,this.yMax=s}}class Q extends C{}class tt{constructor(t){this.cd=t,this.isAvailable=!0,this.isDisabled=!1,this.roll(),this.bomb=null}use(){const t=O[this.type];return this.bomb=new B(t.timer,t.radius),this.isAvailable=!1,this.bomb}roll(){this.type=Math.floor(6*Math.random()),this.isAvailable=!0}}class et{constructor(t,e){this.maxSize=t,this.disabled=0,this.bombSlots=[];for(let i=0;i<t;i++)this.bombSlots.push(new tt(e))}isAvailable(){for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isAvailable&&!this.bombSlots[t].isDisabled)return!0;return!1}isAllExploded(){for(let t=0;t<this.bombSlots.length;t++)if(!this.bombSlots[t].bomb)return!1;for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].bomb.timer>0)return!1;return!0}useBomb(){for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isAvailable&&!this.bombSlots[t].isDisabled)return this.bombSlots[t].use()}roll(){for(let t=0;t<this.bombSlots.length;t++)this.bombSlots[t].isDisabled||this.bombSlots[t].roll()}disable(t,e){this.disabled++,this.disabled,this.maxSize;for(let t=0;t<this.bombSlots.length;t++)if(!this.bombSlots[t].isDisabled)return void(this.bombSlots[t].isDisabled=!0)}enable(){this.disabled--;for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isDisabled)return void(this.bombSlots[t].isDisabled=!1)}}class it{constructor(t){this.at=t}}class st{constructor(t){this.to=t,this.timer=-1}}const nt=(t,e)=>({load:()=>{t.create().add(new G("Start",e.width/2,e.height/2,()=>{window.currentScreen.unload(),window.currentScreen=rt(t).load()}))},unload:()=>{t.select(G).iterate(t=>{t.eject()})}}),rt=t=>({load:()=>{window.mapLoader.next(t)},unload:()=>{window.mapLoader.unload(t)}});var ot=i(0),at=i(1);const lt=(t,e,i)=>{const s=t.layers[0].objects,n=s.find(t=>{if(t.properties)return t.properties.find(t=>"isStart"===t.name)});if(n){const t=new T(n.x,n.y);((t,e)=>{t.create().add(new et(3,3e3)),t.create().add(new I(H),new T(e.x,e.y,e.z),new U(0,0,0),new X(0,0,0),new N,new Z,new K(-.5,-.5,.5,.5))})(e,new T(t.x,t.y,0))}e.create().add(new st,new T(1));const r=s.reduce((t,e)=>{if(e.properties&&e.properties.find(t=>"isSpawn"===t.name)){const i=e.properties.find(t=>"max"===t.name).value,s=e.properties.find(t=>"total"===t.name).value;t.push({x:e.x,y:e.y,total:s,max:i})}return t},[]);console.log(r),r.forEach(t=>{e.create().add(new F(e,t.max,t.total),new T(t.x,t.y,0))});const o=s.find(t=>t.text&&t.text.length>0);o&&e.create().add(new Y(o.text),new T(o.x,o.y),new N);t.layers[1].data.forEach((t,i)=>{0!==t&&e.create().add(new Q(i%20,Math.floor(i/20)))})},ct=t=>{[Q,F,Y,W].forEach(e=>{t.select(e).iterate(t=>{t.eject()})})};document.body.appendChild(document.createElement("canvas"));const ht=document.querySelector("canvas");ht.width=window.innerWidth,ht.height=window.innerHeight;const dt=()=>Math.min(window.innerWidth/20,window.innerHeight/10);window.tileSize=dt(),window.addEventListener("resize",()=>{ht.width=window.innerWidth,ht.height=window.innerHeight,window.tileSize=dt()});const ut=ht.getContext("2d");window.mapLoader=(t=>{const e=[ot,at];let i=-1;return{unload:()=>{ct(t)},next:()=>{ct(t),i++,i<e.length&&lt(e[i],t)}}})(j),j.register(T,U,X,N,Y,I,B,Z,W,F,G,Q,K,J,et,$,it,st),j.process(((t,e)=>{const i=t.select(Y,T);return{update:t=>{i.iterate(t=>{const i=t.get(Y),s=t.get(T);e.textAlign="center",e.font="50px sans-serif",e.fillStyle="rgba(100, 170, 220)",e.fillText(i.sc,s.x*tileSize,s.y*tileSize)})}}})(j,ut),((t,e)=>{const i=t.select(T,I),s=t.select(Q);return{update:t=>{i.iterate(t=>{const i=t.get(T);t.get(I).draw(e,i.clone().multiplyScalar(tileSize),tileSize)}),s.iterate(t=>{const i=t.get(Q);e.fillStyle="",e.fillRect(i.x*tileSize,i.y*tileSize,tileSize,tileSize)})}}})(j,ut),(t=>{const e=t.select(T,N,X,U),i=t.select(Y,N),s=t.select(et);let n=!0;return{update:r=>{i.iterate(t=>{const{isUp:e,isDown:i}=t.get(N);e&&(t.get(Y).isUpPressed=!0),i&&(t.get(Y).isDownPressed=!0)}),e.iterate(e=>{const{isUp:i,isDown:r,isLeft:o,isRight:a,isMain:l}=e.get(N),c=e.get(T),h=e.get(U),d=e.get(X);d.setScalar(0),i?d.setY(-.01):h.y<0&&!r&&h.setY(q(.02+h.y,-Number.MAX_VALUE,0)),r?d.setY(.01):h.y>0&&!i&&h.setY(q(-.02+h.y,0,Number.MAX_VALUE)),o?d.setX(-.01):h.x<0&&!a&&h.setX(q(.02+h.x,-Number.MAX_VALUE,0)),a?d.setX(.01):h.x>0&&!o&&h.setX(q(-.02+h.x,0,Number.MAX_VALUE)),h.add(d).clampScalar(-1/8,1/8),l||n||(n=!0),l&&n&&(n=!1,s.iterate(e=>{const i=e.get(et);if(i.isAvailable()){const e=i.useBomb();t.create().add(e,new T(c.x,c.y,0),new I(1))}}))})}}})(j),((t,e)=>{const i=t.select(B),s=t.select(W,T);return{update:n=>{i.iterate(i=>{const r=i.get(B),o=i.get(T);r.timer-=n;const a=o.x*tileSize,l=o.y*tileSize;e.beginPath(),e.arc(a,l,r.radius*tileSize,0,R),e.closePath(),e.stroke(),e.fillText(Math.ceil(r.timer/1e3),a,l-20),r.timer<0&&(i.eject(),s.iterate(e=>{const i=e.get(T),s=e.get(U),n=e.get(W);i.distance2D(o)<r.radius&&(n.isActive=!1,s.setScalar(0),t.create().add(new J(performance.now()),new T(i.x,i.y,i.z)))}))})}}})(j,ut),(t=>{const e=t.select(F),i=t.select(W);return{update:t=>{e.iterate(e=>{const s=e.get(T),n=e.get(F);if(n.cd-=t,console.log(n.maxHostiles),n.cd<0&&n.total>0){n.cd=3e3;let t=!1;i.iterate(e=>{const i=e.get(W);if(!i.isActive&&!t){i.isActive=!0;e.get(T).set(s),t=!0,n.total--}})}})}}})(j),(t=>{const e=t.select(T,W),i=t.select(T,Z);return{update:s=>{i.iterate(i=>{const s=i.get(T);e.iterate(e=>{const i=e.get(W);if(i.isActive){const n=e.get(T),r=e.get(U);if(i.isAttacking)r.setScalar(0);else{const t=s.clone().sub(n);r.set(t.normalise().multiplyScalar(.1))}s.distance2D(n)<1&&!i.isAttacking&&(i.isAttacking=!0,t.create().add(new $(i,performance.now()),new T(n.x,n.y,n.z)))}})})}}})(j),((t,e)=>{const i=t.select(G);return{update:()=>{i.iterate(t=>{const i=t.get(G);e.fillText(i.text,i.x,i.y)})}}})(j,ut),((t,e,i)=>{const s=t.select(Z),n=new C(10*i,100);return{update:()=>{s.iterate(s=>{const r=s.get(Z);r.hp<=0?(mapLoader.unload(t),window.currentScreen=((t,e)=>{t.create().add(new G("You died",20*e/2,10*e/2,()=>{}))})(t,i)):(e.fillStyle="#000",e.fillRect(n.x,n.y,420,50),e.fillStyle="red",e.fillRect(n.x+10,n.y+10,4*r.hp,30))})}}})(j,ut,tileSize),((t,e)=>{const i=t.select(st,T),s=t.select(Z,T);return{update:()=>{s.iterate(t=>{const s=t.get(T);i.iterate(t=>{const i=t.get(T);t.get(st);switch(e.fillStyle="#9e333d",i.x){case 0:e.fillRect(5*tileSize,0*tileSize,4*tileSize,tileSize);break;case 1:((t,e,i)=>t.x+1>e.x&&t.x<e.x+i.x&&t.y>e.y&&t.y<e.y+i.y)(s,new C(19,3),new C(1,4))&&(window.mapLoader.next(),s.x=0),e.fillRect(19*tileSize,3*tileSize,tileSize,4*tileSize);break;case 2:e.fillRect(5*tileSize,9*tileSize,4*tileSize,tileSize);break;case 3:e.fillRect(0*tileSize,3*tileSize,tileSize,4*tileSize)}})})}}})(j,ut),((t,e)=>{const i=t.select(K,U,T),s=t.select(Q);let n=!1;return{update:()=>{i.iterate(t=>{const e=t.get(T),i=t.get(U);if(0===i.x&&0===i.y)return;const r=t.get(K);e.x+r.xMin<0&&(e.x=-r.xMin,i.x=-i.x),e.y+r.yMin<0&&(e.y=-r.yMin,i.y=-i.y),e.x-r.xMax>19&&(e.x=19+r.xMax,i.x=-i.x),e.y-r.yMax>9&&(e.y=9+r.yMax,i.y=-i.y),n=!1,s.iterate(t=>{const s=t.get(Q),o=e.clone();o.add(i),o.x+r.xMax>s.x&&o.x+r.xMax<s.x+1?o.y+r.yMax>s.y&&o.y+r.yMax<s.y+1?i.angle()>new C(o.x+r.xMax-s.x,o.y+r.yMax-s.y).angle()&&i.y>0?(e.y=s.y+r.yMin,e.x+=i.x*((o.y-e.y)/i.y),i.y=-i.y,n=!0):(e.x=s.x+r.xMin,e.y+=i.y*((o.x-e.x)/i.x),i.x=-i.x,n=!0):o.y+r.yMin>s.y&&o.y+r.yMin<s.y+1&&(i.angle()>new C(o.x+r.xMax-s.x,o.y+r.yMax-(s.y+1)).angle()?(e.y=s.y+1+r.xMax,e.x+=i.x*((o.y-e.y)/i.y),i.y=-i.y,n=!0):(e.x=s.x+r.xMin,e.y+=i.y*((o.x-e.x)/i.x),i.x=-i.x,n=!0)):o.x+r.xMin>s.x&&o.x+r.xMin<s.x+1&&(o.y+r.yMax>s.y&&o.y+r.yMax<s.y+1?i.angle()>new C(o.x+r.xMin-(s.x+1),o.y+r.yMax-s.y).angle()?(e.x=s.x+1+r.xMax,e.y+=i.y*((o.x-e.x)/i.x),i.x=-i.x,n=!0):(e.y=s.y+r.yMin,e.x+=i.x*((o.y-e.y)/i.y),i.y=-i.y,n=!0):o.y+r.yMin>s.y&&o.y+r.yMin<s.y+1&&(i.angle()<new C(o.x+r.xMin-(s.x+1),o.y+r.yMin-(s.y+1)).angle()?(e.x=s.x+1+r.xMax,e.y+=i.y*((o.x-e.x)/i.x),i.x=-i.x,n=!0):(e.y=s.y+1+r.xMax,e.x+=i.x*((o.y-e.y)/i.y),i.y=-i.y,n=!0)))}),n||e.add(i)})}}})(j),((t,e,i)=>{const s=new C(10*i-300,10*i+100),n=t.select(et);return{update(){n.iterate(t=>{const i=t.get(et);for(let t=1;t<=i.bombSlots.length;t++){let n=i.bombSlots[t-1];e.fillStyle=n.isDisabled?"rgba(200, 30, 30, .5)":"rgba(30, 130, 30, .5)",e.fillRect(s.x+105*t,s.y,100,100),e.fillStyle="#000",e.fillText(n.isAvailable,s.x+105*t,s.y),e.fillText(n.type,s.x+105*t,s.y)}!i.isAvailable()&&i.isAllExploded()&&i.roll()})}}})(j,ut,tileSize),((t,e)=>{const i=t.select(J,T);return{update:()=>{i.iterate(t=>{const i=t.get(T);t.get(J);e.fillStyle="#eee",e.beginPath(),e.arc(i.x*tileSize,i.y*tileSize,10,0,R),e.closePath(),e.fill()})}}})(j,ut),((t,e,i)=>{const s=t.select($),n=t.select(Z);t.select(et);return{update:()=>{s.iterate(i=>{const s=i.get($),r=i.get(T);e.beginPath(),e.arc(r.x*tileSize,r.y*tileSize,2*tileSize,0,R),e.fillStyle="rgba(200,200,200, .4)",e.closePath(),e.fill(),performance.now()-s.at>500&&(n.iterate(t=>{const e=t.get(T),i=t.get(Z);r.distance2D(e)<2&&(i.hp-=15)}),s.hostile.isAttacking=!1,i.eject(),t.create().add(new T(r.x,r.y,r.z),new it(performance.now())))})}}})(j,ut),((t,e)=>{const i=t.select(it);return{update:t=>{i.iterate(t=>{const i=t.get(it);if(performance.now()-i.at>300)return void t.eject();const s=t.get(T);e.beginPath(),e.fillStyle="rgba(200, 30, 30, .7)",e.arc(s.x*tileSize,s.y*tileSize,2*tileSize,0,R),e.closePath(),e.fill()})}}})(j,ut)),window.currentScreen=nt(j,ht),nt(j,ht).load();let yt,xt=0;const ft=()=>{yt=performance.now(),ht.width+=0,j.update(yt-xt),xt=yt,requestAnimationFrame(ft)};ft()}]);