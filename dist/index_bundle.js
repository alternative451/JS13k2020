!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(t){t.exports=JSON.parse('{"rowLen":7350,"endPattern":4,"songData":[{"osc1_oct":7,"osc1_det":0,"osc1_detune":0,"osc1_xenv":0,"osc1_vol":192,"osc1_waveform":2,"osc2_oct":7,"osc2_det":0,"osc2_detune":0,"osc2_xenv":0,"osc2_vol":201,"osc2_waveform":3,"noise_fader":0,"env_attack":100,"env_sustain":150,"env_release":13636,"env_master":92,"fx_filter":2,"fx_freq":4280,"fx_resonance":111,"fx_delay_time":6,"fx_delay_amt":121,"fx_pan_freq":6,"fx_pan_amt":64,"lfo_osc1_freq":0,"lfo_fx_freq":1,"lfo_freq":6,"lfo_amt":75,"lfo_waveform":0,"p":[1,1,3],"c":[{"n":[147,0,0,0,147,0,0,0,149,0,0,0,147,0,0,0,151,0,0,0,154,0,0,0,153,0,0,0,157,0,0,0]},{"n":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"n":[157,0,0,0,158,0,0,0,156,0,0,0,157,0,0,0,157,0,0,0,160,0,0,0,159,0,0,0,158,0,0,0]}]},{"osc1_oct":7,"osc1_det":0,"osc1_detune":0,"osc1_xenv":1,"osc1_vol":255,"osc1_waveform":0,"osc2_oct":7,"osc2_det":0,"osc2_detune":0,"osc2_xenv":1,"osc2_vol":255,"osc2_waveform":0,"noise_fader":0,"env_attack":50,"env_sustain":150,"env_release":4800,"env_master":200,"fx_filter":2,"fx_freq":600,"fx_resonance":254,"fx_delay_time":0,"fx_delay_amt":0,"fx_pan_freq":0,"fx_pan_amt":0,"lfo_osc1_freq":0,"lfo_fx_freq":0,"lfo_freq":0,"lfo_amt":0,"lfo_waveform":0,"p":[0,2,2],"c":[{"n":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"n":[152,0,0,0,152,0,0,0,152,0,0,0,154,0,0,0,154,0,0,0,152,0,0,0,152,0,0,0,152,0,0,0]}]},{"osc1_oct":8,"osc1_det":0,"osc1_detune":0,"osc1_xenv":0,"osc1_vol":0,"osc1_waveform":0,"osc2_oct":8,"osc2_det":0,"osc2_detune":0,"osc2_xenv":0,"osc2_vol":0,"osc2_waveform":0,"noise_fader":60,"env_attack":50,"env_sustain":419,"env_release":4607,"env_master":130,"fx_filter":1,"fx_freq":10332,"fx_resonance":120,"fx_delay_time":4,"fx_delay_amt":16,"fx_pan_freq":5,"fx_pan_amt":108,"lfo_osc1_freq":0,"lfo_fx_freq":0,"lfo_freq":5,"lfo_amt":187,"lfo_waveform":0,"p":[0,0,4],"c":[{"n":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"n":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"n":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"n":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,147,147,147,147]}]}],"songLen":23}')},function(t){t.exports=JSON.parse('{"compressionlevel":-1,"editorsettings":{"export":{"format":"json","target":"welcome.json"}},"height":12,"infinite":false,"layers":[{"draworder":"topdown","id":2,"name":"Calque d\'Objets 1","objects":[{"height":0,"id":1,"name":"","point":true,"properties":[{"name":"isStart","type":"bool","value":true}],"rotation":0,"type":"","visible":true,"width":0,"x":4.49448797841185,"y":4.20380736507405},{"height":19,"id":2,"name":"","properties":[{"name":"doors","type":"int","value":2}],"rotation":0,"text":{"fontfamily":"MS Shell Dlg 2","pixelsize":3,"text":"Move with zqsd or wasd","wrap":true},"type":"","visible":true,"width":108,"x":10.8364,"y":3.23701}],"opacity":1,"type":"objectgroup","visible":true,"x":0,"y":0},{"data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,131,131,131,131,0,0,131,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,131,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,131,0,0,0,0,0,131,0,0,0,0,131,131,0,0,0,131,131,131,0,0,0,131,0,0,131,131,131,131,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,131,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,131,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"height":12,"id":1,"name":"Calque de Tuiles 1","opacity":1,"type":"tilelayer","visible":true,"width":22,"x":0,"y":0}],"nextlayerid":3,"nextobjectid":6,"orientation":"orthogonal","properties":[{"name":"bombs","type":"string","value":"1,1,1"},{"name":"canRoll","type":"bool","value":false}],"renderorder":"left-up","tiledversion":"1.4.1","tileheight":1,"tilesets":[{"firstgid":1,"source":"aos.tsx"}],"tilewidth":1,"type":"map","version":1.4,"width":22}')},function(t){t.exports=JSON.parse('{"compressionlevel":-1,"editorsettings":{"export":{"format":"json","target":"level1_bombs.json"}},"height":12,"infinite":false,"layers":[{"draworder":"topdown","id":2,"name":"Calque d\'Objets 1","objects":[{"height":0,"id":1,"name":"","point":true,"properties":[{"name":"isDestroyable","type":"bool","value":true}],"rotation":0,"type":"","visible":true,"width":0,"x":11.3014,"y":10.0217},{"height":19,"id":2,"name":"","rotation":0,"text":{"fontfamily":"MS Shell Dlg 2","pixelsize":1,"text":"Press [space] to destroy objective","wrap":true},"type":"","visible":true,"width":108,"x":10.8695695652174,"y":2.63043391304348},{"height":19,"id":3,"name":"","rotation":0,"text":{"fontfamily":"MS Shell Dlg 2","pixelsize":1,"text":"(The black square)","wrap":true},"type":"","visible":true,"width":108,"x":10.7282613043478,"y":8.09782173913043}],"opacity":1,"type":"objectgroup","visible":true,"x":0,"y":0},{"data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,649,649,649,649,649,649,649,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,649,649,649,649,649,649,649,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"height":12,"id":1,"name":"Calque de Tuiles 1","opacity":1,"type":"tilelayer","visible":true,"width":22,"x":0,"y":0}],"nextlayerid":3,"nextobjectid":4,"orientation":"orthogonal","properties":[{"name":"0","type":"int","value":0}],"renderorder":"right-down","tiledversion":"1.4.1","tileheight":1,"tilesets":[{"firstgid":1,"source":"aos.tsx"}],"tilewidth":1,"type":"map","version":1.4,"width":22}')},function(t){t.exports=JSON.parse('{"compressionlevel":-1,"editorsettings":{"export":{"format":"json","target":"level2_bombsMoove.json"}},"height":12,"infinite":false,"layers":[{"draworder":"topdown","id":2,"name":"Calque d\'Objets 1","objects":[{"height":19,"id":2,"name":"","rotation":0,"text":{"fontfamily":"MS Shell Dlg 2","pixelsize":1,"text":"Green Bombs can be pushed","wrap":true},"type":"","visible":true,"width":108,"x":7.95652608695652,"y":2.8478252173913},{"height":0,"id":4,"name":"","point":true,"properties":[{"name":"isRed","type":"bool","value":true},{"name":"status","type":"int","value":3}],"rotation":0,"type":"","visible":true,"width":0,"x":19.6521739130435,"y":5.69565217391304}],"opacity":1,"type":"objectgroup","visible":true,"x":0,"y":0},{"data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"height":12,"id":1,"name":"Calque de Tuiles 1","opacity":1,"type":"tilelayer","visible":true,"width":22,"x":0,"y":0}],"nextlayerid":3,"nextobjectid":5,"orientation":"orthogonal","properties":[{"name":"bombs","type":"string","value":"4,4,4"}],"renderorder":"right-down","tiledversion":"1.4.1","tileheight":1,"tilesets":[{"firstgid":1,"source":"aos.tsx"}],"tilewidth":1,"type":"map","version":1.4,"width":22}')},function(t,e,i){"use strict";i.r(e);const n=Math;function o(t){return n.sin(6.283184*t)}var r=[o,function(t){return o(t)<0?-1:1},function(t){return t%1-.5},function(t){var e=t%1*4;return e<2?e-1:3-e}];function l(t){return.00390625*n.pow(1.059463094,t-128)}function a(t){return{left:new Float32Array(t),right:new Float32Array(t)}}function c(t,e,i,s){for(var n=i.fx_delay_time*s>>1,o=i.fx_delay_amt/255,r=0;r<e-n;){var l=r,a=r+n;t.left[a]+=t.right[l]*o,t.right[a]+=t.left[l]*o,r++}}function h(t,e){var i=t.createBuffer(2,e.left.length,44100);return i.getChannelData(0).set(e.left),i.getChannelData(1).set(e.right),i}var f=function(t,e,i){this.ctx=t,this.instr=e,this.rowLen=i||5605,this.osc_lfo=r[e.lfo_waveform],this.osc1=r[e.osc1_waveform],this.osc2=r[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=n.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=n.pow(2,e.lfo_freq-8)/this.rowLen};f.prototype._genSound=function(t,e,i){for(var s=0,r=0,a=l(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),c=l(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),h=this.instr.fx_resonance/255,f=0,d=0,y=e.left.length,u=this.attack+this.sustain+this.release-1;u>=0;--u){var x=u+i,p=this.osc_lfo(x*this.lfoFreq)*this.instr.lfo_amt/512+.5,g=1;u<this.attack?g=u/this.attack:u>=this.attack+this.sustain&&(g-=(u-this.attack-this.sustain)/this.release);var m=a;this.instr.lfo_osc1_freq&&(m+=p),this.instr.osc1_xenv&&(m*=g*g),s+=m;var S=this.osc1(s)*this.instr.osc1_vol;m=c,this.instr.osc2_xenv&&(m*=g*g),r+=m,S+=this.osc2(r)*this.instr.osc2_vol,this.instr.noise_fader&&(S+=(2*n.random()-1)*this.instr.noise_fader*g),S*=g/255;var w=this.instr.fx_freq;this.instr.lfo_fx_freq&&(w*=p);var b=h*(S-d)-(f+=(w=1.5*n.sin(3.141592*w/44100))*d);switch(d+=w*b,this.instr.fx_filter){case 1:S=b;break;case 2:S=f;break;case 3:S=d;break;case 4:S=f+b}m=o(x*this.panFreq)*this.instr.fx_pan_amt/512+.5,S*=.00476*this.instr.env_master,x<y&&(e.left[x]+=S*(1-m),e.right[x]+=S*m)}},f.prototype._createAudioBuffer=function(t,e){var i=this.attack+this.sustain+this.release-1+32*this.rowLen,s=a(i);this._genSound(t,s,0),c(s,i,this.instr,this.rowLen),e(h(this.ctx,s))};var d=function(t,e){this.ctx=t,this.song=e,this.waveSize=44100*e.songLen};d.prototype._generateTrack=function(t,e,i){var s=a(this.waveSize),n=this.waveSize,o=this.song.rowLen,r=this.song.endPattern,l=new f(this.ctx,t,o),h=0,d=0,y=0,u=function(){for(var e=Date.now();;)if(32!==y){if(d===r-1)return x();var i=t.p[d];if(i){var n=t.c[i-1].n[y];n&&l._genSound(n,s,h)}if(h+=o,y+=1,Date.now()-e>33)return void setTimeout(u,0)}else y=0,d+=1},x=function(){c(s,n,t,o);for(var r=0;r<n;r++)e.left[r]+=s.left[r];for(r=0;r<n;r++)e.right[r]+=s.right[r];i()};u()},d.prototype._createAudioBuffer=function(t){var e=this,i=a(this.waveSize),s=0,n=function(){s<e.song.songData.length?(s+=1,e._generateTrack(e.song.songData[s-1],i,n)):t(h(e.ctx,i))};n()};var u=new(window.webkitAudioContext||window.AudioContext);const p=async t=>new Promise(e=>{!function(t,e,i){new d(t,e)._createAudioBuffer(i)}(u,t,t=>{e(t)})});var g=i(0),m=[],S=[],w={},b="_sign",v="_mask";"undefined"!=typeof Symbol&&(b=Symbol(b),v=Symbol(v));var _=function(t,e){var i=e[t];if(!i)throw new Error("The component is not registered");return i},M=_.bind(null,b),k=_.bind(null,v),A=function(t){t.id&&m.forEach((function(e){return e.match(t)}))},E=1,C={},D=function(t){this.id=t||(E++).toString(36),this.components=Object.assign({},C),this.mask=0};D.prototype.add=function(){for(var t=this,e=[],i=arguments.length;i--;)e[i]=arguments[i];e.forEach((function(e){t.components[M(e.constructor)]=e,t.mask|=k(e.constructor)})),A(this)},D.prototype.remove=function(){for(var t=this,e=[],i=arguments.length;i--;)e[i]=arguments[i];e.forEach((function(e){var i=M(e),s=t.components[i];s&&(s.destructor&&s.destructor(),delete t.components[i],t.mask&=~k(e))})),A(this)},D.prototype.has=function(t){return M(t)in this.components},D.prototype.get=function(t){return this.components[t[b]]},D.prototype.eject=function(){!function(t){var e=t.components;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=e[i];s&&s.destructor&&s.destructor()}m.forEach((function(e){return e.remove(t)})),delete w[t.id],t.id=0}(this)};var R=function(t,e){this.entity=t,this.prev=null,this.next=e},P=function(t){if(!t)throw new Error("Empty selector");for(var e in this.mask=t,this.map={},this.list=null,this.length=0,w)Object.prototype.hasOwnProperty.call(w,e)&&this.match(w[e])};P.prototype.iterate=function(t){for(var e=this.list;e;)t(e.entity),e=e.next},P.prototype.match=function(t){(this.mask&t.mask)===this.mask?this.add(t):this.remove(t)},P.prototype.add=function(t){if(!this.map[t.id]){var e=new R(t,this.list);this.list&&(this.list.prev=e),this.list=e,this.map[t.id]=e,this.length++}},P.prototype.remove=function(t){var e=this.map[t.id];e&&(e.prev?e.prev.next=e.next:this.list=e.next,e.next&&(e.next.prev=e.prev),delete this.map[t.id],this.length--)};var j=0,T=performance||Date,q=T.now.bind(T),B={register:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach((function(t){if(j>31)throw new Error("Components limit reached");if(!t[b]){var e=j.toString(36);C[e]=null,t[b]=e,t[v]=1<<j,j++}}))},process:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach((function(t){return S.push(t)}))},create:function(t){var e=new D(t);if(w[e.id])throw new Error("The ID already exist");return w[e.id]=e,e},get:function(t){return w[t]},select:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var i=0;t.forEach((function(t){i|=k(t)}));for(var s=0;s<m.length;s++)if(m[s].mask===i)return m[s];var n=new P(i);return m.push(n),n},update:function(t){var e={};return S.forEach((function(i){var s=q();i.update(t),e[i.constructor.name]=q()-s})),e}};class L{constructor(t,e,i){this.x=t,this.y=e,this.z=i}setX(t){this.x=t}setY(t){this.y=t}setZ(t){this.z=t}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}dot2D(t){return this.x*t.x+this.y*t.y}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}setScalar(t){return this.x=t,this.y=t,this.z=t,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}clone(){return new L(this.x,this.y,this.z)}distance2D(t){return Math.hypot(this.x-t.x,this.y-t.y)}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}normalise(){return this.divideScalar(this.length())}set(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}toString(){return`${x} ${y} ${z}`}}const F=(t,e,i,s,n,o)=>{e.fillStyle=o,e.fillRect(t.x+90*n+10*(i+1),t.y+10*(s+1),10,10)},O=(t,e,i,s,n,o)=>{switch(s.fillStyle="#000",s.fillRect(t.x+90*i,t.y,100,100),s.fillStyle=e.isAvailable?"#010C14":"#470605",s.fillRect(t.x+90*i+10,t.y+10,80,80),n&&(s.fillStyle="rgba(30, 130, 30, 1)",s.fillRect(t.x+90*i+10,t.y+10,80*o,80)),s.fillStyle="#000",e.type){case 0:F(t,s,1,0,i,"#D98A14"),F(t,s,1,1,i,"#F0740A"),F(t,s,4,1,i,"#D98A14"),F(t,s,5,1,i,"#E64F09"),F(t,s,7,2,i,"#F0AB0A"),F(t,s,3,3,i,"#F0AB0A"),F(t,s,4,3,i,"#F0AB0A"),F(t,s,3,4,i,"#F0AB0A"),F(t,s,4,4,i,"#F0AB0A"),F(t,s,1,4,i,"#D98A14"),F(t,s,2,7,i,"#F0740A"),F(t,s,3,7,i,"#D98A14"),F(t,s,5,6,i,"#F0AB0A"),F(t,s,5,7,i,"#E64F09");break;case 1:F(t,s,2,1,i,"#8CC1E9"),F(t,s,2,3,i,"#8CC1E9"),F(t,s,2,4,i,"#8CC1E9"),F(t,s,2,6,i,"#8CC1E9"),F(t,s,2,7,i,"#8CC1E9"),F(t,s,0,3,i,"#8CC1E9"),F(t,s,0,5,i,"#8CC1E9"),F(t,s,1,5,i,"#8CC1E9"),F(t,s,0,7,i,"#8CC1E9"),F(t,s,3,5,i,"#8CC1E9"),F(t,s,4,5,i,"#8CC1E9"),F(t,s,6,5,i,"#8CC1E9"),F(t,s,5,2,i,"#8CC1E9"),F(t,s,4,3,i,"#8CC1E9"),F(t,s,4,7,i,"#8CC1E9");break;case 2:F(t,s,5,0,i,"#eee"),F(t,s,5,1,i,"#eee"),F(t,s,4,2,i,"#eee"),F(t,s,1,3,i,"#eee"),F(t,s,3,3,i,"#eee"),F(t,s,4,3,i,"#eee"),F(t,s,6,3,i,"#eee"),F(t,s,3,4,i,"#eee"),F(t,s,2,5,i,"#eee"),F(t,s,2,6,i,"#eee");break;case 3:F(t,s,3,3,i,"#B11913"),F(t,s,3,4,i,"#B11913"),F(t,s,4,3,i,"#B11913"),F(t,s,4,4,i,"#B11913"),F(t,s,2,1,i,"#B11913"),F(t,s,1,2,i,"#B11913"),F(t,s,1,3,i,"#B11913"),F(t,s,1,4,i,"#B11913"),F(t,s,1,5,i,"#B11913"),F(t,s,2,6,i,"#B11913"),F(t,s,5,1,i,"#B11913"),F(t,s,6,2,i,"#B11913"),F(t,s,6,3,i,"#B11913"),F(t,s,6,4,i,"#B11913"),F(t,s,6,5,i,"#B11913"),F(t,s,5,6,i,"#B11913");break;case 4:F(t,s,1,3,i,"#97E614"),F(t,s,1,4,i,"#97E614"),F(t,s,2,3,i,"#97E614"),F(t,s,2,4,i,"#97E614"),F(t,s,4,4,i,"#97E614"),F(t,s,6,4,i,"#97E614")}},N=(t,e,i)=>{e.fillStyle="#fff",e.fillRect(t.x,t.y,1*tileSize,1*tileSize),e.fillStyle="#57D0EB",e.fillRect(t.x+2,t.y+2,1*tileSize-4,1*tileSize-4)},W=(t,e,i)=>{e.fillStyle="#fff",e.fillRect(t.x,t.y,1*tileSize,1*tileSize),e.fillStyle="#520E0E",e.fillRect(t.x+2,t.y+2,1*tileSize-4,1*tileSize-4)},H=(t,e,i)=>{e.fillStyle="#fff",e.fillRect(t.x*tileSize,t.y*tileSize,1*tileSize,1*tileSize),e.fillStyle="#000",e.fillRect(t.x*tileSize+2,t.y*tileSize+2,1*tileSize-4,1*tileSize-4)},U=(t,e,i)=>{e.fillStyle="#fff",e.beginPath(),e.arc(t.x,t.y,.5*tileSize,0,I),e.closePath(),e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(t.x,t.y,.5*tileSize-2,0,I),e.closePath(),e.fill()},Y=(t,e,i)=>Math.max(e,Math.min(i,t)),I=2*Math.PI,X=(t,e,i,s,n)=>{const o=t.create();return o.add(new it(null,n,i,s),new $(e.x,e.y,e.z),new tt(W),new G(0,0,0),new rt(0,0,1,1)),o};class $ extends L{}class G extends L{}class J extends L{}class V{constructor(t,e,i,s){this.type=s,this.cd=1e3,this.maxHostiles=e,this.total=i,this.hostiles=[];for(let e=0;e<this.maxHostiles;e++)this.hostiles.push(X(t,new $(0,0,0),!1,null,s))}remaining(){let t=0;for(let e=0;e<this.hostiles.length;e++)this.hostiles[e].get(it).isActive&&t++;return this.total+t}hasOne(){for(let t=0;t<this.hostiles.length;t++)if(!1===this.hostiles[t].get(it).isActive)return this.hostiles[t];return!1}active(t){const e=this.hasOne();e&&(e.get(it).isActive=!0,e.get($).set(t))}}class Z{constructor(){this.isUp=!1,this.isLeft=!1,this.isRight=!1,this.isDown=!1,this.isMain=!1,window.addEventListener("keydown",t=>{90!==t.keyCode&&87!==t.keyCode||(this.isUp=!0),32===t.keyCode&&(this.isMain=!0),81!==t.keyCode&&65!==t.keyCode||(this.isLeft=!0),68===t.keyCode&&(this.isRight=!0),83===t.keyCode&&(this.isDown=!0)}),window.addEventListener("keyup",t=>{90!==t.keyCode&&87!==t.keyCode||(this.isUp=!1),32===t.keyCode&&(this.isMain=!1),81!==t.keyCode&&65!==t.keyCode||(this.isLeft=!1),68===t.keyCode&&(this.isRight=!1),83===t.keyCode&&(this.isDown=!1)})}}class K{constructor(t){this.sc=t}}class Q{constructor(t,e,i){this.triggered=!1,this.armed=!1,this.type=t,this.remaining=e,this.total=e,this.radius=i}}class tt{constructor(t){this.draw=t}}class et{constructor(t){this.diedAt=t}}class it{constructor(t,e,i,s){this.target=t,this.isActive=i,this.type=e,this.isAttacking=!1,this.effect=s,this.effectTime=1e4}}class st{constructor(t,e,i){this.hostile=t,this.type=i,this.remaining=e}}class nt{constructor(){this.hp=100}}class ot{constructor(t,e,i,s,n){this.text=t,this.x=e,this.y=i,this.isButton=n,this.isHover=!1,this.add=t=>{t.pageY>i&&t.pageY<i+150&&s()},this.move=t=>{t.pageY>i&&t.pageY<i+150?this.isHover=!0:this.isHover=!1},this.isButton&&(window.addEventListener("mousedown",this.add),window.addEventListener("mousemove",this.move))}destructor(){this.isButton&&window.removeEventListener("mousedown",this.add)}}class rt{constructor(t,e,i,s){this.xMin=t,this.yMin=e,this.xMax=i,this.yMax=s}}class lt extends L{}class at{constructor(t){this.cd=t,this.isAvailable=!0,this.isDisabled=!1,this.roll(),this.bomb=null}use(){return this.bomb=new Q(this.type,3===this.type||4===this.type?5e3:2500,3),this.isAvailable=!1,this.bomb}roll(){this.type=Math.floor(5*Math.random()),this.isAvailable=!0}set(t){this.type=t,this.isAvailable=!0}}class ct{constructor(t,e){this.maxSize=t,this.disabled=0,this.bombSlots=[],this.isRolling=!1,this.canRoll=!0,this.rollAt=-1;for(let i=0;i<t;i++)this.bombSlots.push(new at(e))}isAvailable(){for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isAvailable&&!this.bombSlots[t].isDisabled)return!0;return!1}isAllExploded(){for(let t=0;t<this.bombSlots.length;t++)if(!this.bombSlots[t].bomb)return!1;for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].bomb.timer>0)return!1;return!0}useBomb(){for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isAvailable&&!this.bombSlots[t].isDisabled)return this.bombSlots[t].use()}initRoll(){this.isRolling=!0,this.rollTime=0}roll(){this.isRolling=!1;for(let t=0;t<this.bombSlots.length;t++)this.bombSlots[t].isDisabled||this.bombSlots[t].roll()}set(t){t.forEach((t,e)=>{this.bombSlots[e].set(t)})}disable(t,e){this.disabled++,this.disabled,this.maxSize;for(let t=0;t<this.bombSlots.length;t++)if(!this.bombSlots[t].isDisabled)return void(this.bombSlots[t].isDisabled=!0)}enable(){this.disabled--;for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isDisabled)return void(this.bombSlots[t].isDisabled=!1)}}class ht{constructor(t){this.at=t}}class ft{constructor(t){this.to=t,this.timer=-1}}class dt{constructor(t){this.remaining=300,this.points=[],this.bombType=t;for(let t=0;t<9;t++){const t=Math.random()*I;this.points.push(new L(Math.cos(t),Math.sin(t)))}}}class yt{constructor(){this.blink=0,this.exploded=!1}}const ut=t=>{[ot,nt,ct].forEach(e=>{t.select(e).iterate(t=>{t.eject()})})},xt=(t,e)=>({isGame:!1,load:()=>{t.create().add(new ot("Play game !",e.width/2-150,e.height/2,()=>{window.currentScreen.unload(),window.currentScreen=pt(t),window.currentScreen.load()},!0))},unload:()=>{t.select(ot).iterate(t=>{t.eject()})}}),pt=t=>({isGame:!0,load:()=>{window.mapLoader.next(t)},unload:()=>{ut(t),window.mapLoader.unload(t)}});function gt(t){for(var e=t,i=[];e.parent;)i.unshift(e),e=e.parent;return i}const mt={search:function(t,e,i,s){t.cleanDirty();var n=(s=s||{}).heuristic||mt.heuristics.manhattan,o=s.closest||!1,r=new bt((function(t){return t.f})),l=e;for(e.h=n(e,i),t.markDirty(e),r.push(e);r.size()>0;){var a=r.pop();if(a===i)return gt(a);a.closed=!0;for(var c=t.neighbors(a),h=0,f=c.length;h<f;++h){var d=c[h];if(!d.closed&&!d.isWall()){var y=a.g+d.getCost(a),u=d.visited;(!u||y<d.g)&&(d.visited=!0,d.parent=a,d.h=d.h||n(d,i),d.g=y,d.f=d.g+d.h,t.markDirty(d),o&&(d.h<l.h||d.h===l.h&&d.g<l.g)&&(l=d),u?r.rescoreElement(d):r.push(d))}}}return o?gt(l):[]},heuristics:{manhattan:function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},diagonal:function(t,e){var i=Math.sqrt(2),s=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);return 1*(s+n)+(i-2)*Math.min(s,n)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}};function St(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var i=0;i<t.length;i++){this.grid[i]=[];for(var s=0,n=t[i];s<n.length;s++){var o=new wt(i,s,n[s]);this.grid[i][s]=o,this.nodes.push(o)}}this.init()}function wt(t,e,i){this.x=t,this.y=e,this.weight=i}function bt(t){this.content=[],this.scoreFunction=t}St.prototype.init=function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)mt.cleanNode(this.nodes[t])},St.prototype.cleanDirty=function(){for(var t=0;t<this.dirtyNodes.length;t++)mt.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]},St.prototype.markDirty=function(t){this.dirtyNodes.push(t)},St.prototype.neighbors=function(t){var e=[],i=t.x,s=t.y,n=this.grid;return n[i-1]&&n[i-1][s]&&e.push(n[i-1][s]),n[i+1]&&n[i+1][s]&&e.push(n[i+1][s]),n[i]&&n[i][s-1]&&e.push(n[i][s-1]),n[i]&&n[i][s+1]&&e.push(n[i][s+1]),this.diagonal&&(n[i-1]&&n[i-1][s-1]&&e.push(n[i-1][s-1]),n[i+1]&&n[i+1][s-1]&&e.push(n[i+1][s-1]),n[i-1]&&n[i-1][s+1]&&e.push(n[i-1][s+1]),n[i+1]&&n[i+1][s+1]&&e.push(n[i+1][s+1])),e},St.prototype.toString=function(){for(var t=[],e=this.grid,i=0;i<e.length;i++){for(var s=[],n=e[i],o=0;o<n.length;o++)s.push(n[o].weight);t.push(s.join(" "))}return t.join("\n")},wt.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},wt.prototype.getCost=function(t){return t&&t.x!=this.x&&t.y!=this.y?1.41421*this.weight:this.weight},wt.prototype.isWall=function(){return 0===this.weight},bt.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),i=this.content.pop();e!==this.content.length-1&&(this.content[e]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];t>0;){var i=(t+1>>1)-1,s=this.content[i];if(!(this.scoreFunction(e)<this.scoreFunction(s)))break;this.content[i]=e,this.content[t]=s,t=i}},bubbleUp:function(t){for(var e=this.content.length,i=this.content[t],s=this.scoreFunction(i);;){var n,o=t+1<<1,r=o-1,l=null;if(r<e){var a=this.content[r];(n=this.scoreFunction(a))<s&&(l=r)}if(o<e){var c=this.content[o];this.scoreFunction(c)<(null===l?s:n)&&(l=o)}if(null===l)break;this.content[t]=this.content[l],this.content[l]=i,t=l}}};var vt=i(1),zt=i(2),_t=i(3);const Mt=(t,e,...i)=>e.reduce((e,s)=>{if(!s.properties)return e;return s.properties.find(e=>e.name===t)&&e.push({x:s.x,y:s.y,...s.properties.reduce((t,e)=>(-1!==i.indexOf(e.name)&&(t[e.name]=e.value),t),{})}),e},[]),kt=(t,e,i)=>{const s=t.layers[0].objects,n=Mt("isStart",s);if(n.length>0){const t=new $(n[0].x,n[0].y);((t,e)=>{t.create().add(new ct(3,3e3)),t.create().add(new tt(N),new $(e.x,e.y,e.z),new G(0,0,0),new J(0,0,0),new Z,new nt,new rt(0,0,1,1))})(e,new $(t.x,t.y,0))}if(e.select(ct).iterate(t=>{t.get(ct).canRoll=!0}),t.properties){const i=t.properties.find(t=>"bombs"===t.name);if(i){const t=i.value.split(",").map(t=>parseInt(t,10));e.select(ct).iterate(e=>{e.get(ct).set(t)})}const s=t.properties.find(t=>"canRoll"===t.name);s&&e.select(ct).iterate(t=>{t.get(ct).canRoll=s.value})}e.create().add(new ft,new $(1));Mt("isSpawn",s,"max","total","type").forEach(t=>{e.create().add(new V(e,t.max,t.total,t.type?t.type:0),new $(t.x,t.y,0))});Mt("isRed",s,"status").forEach(t=>{X(e,new $(t.x,t.y,0),!0,parseInt(t.status,10),0)});Mt("isDestroyable",s).forEach(t=>{e.create().add(new yt,new $(t.x,t.y,0))});s.filter(t=>t.text&&t.text.text.length>0).forEach(t=>{e.create().add(new K(t.text.text),new $(t.x,t.y),new Z)});t.layers[1].data.forEach((t,i)=>{0!==t&&e.create().add(new lt(i%22,Math.floor(i/22)))})},At=t=>{[yt,lt,V,K,it,ft,et,Q,st,ht].forEach(e=>{t.select(e).iterate(t=>{t.eject()})});t.select(ct).iterate(t=>{t.get(ct).roll()})};document.body.appendChild(document.createElement("canvas"));const Et=document.querySelector("canvas");Et.width=window.innerWidth,Et.height=window.innerHeight;const Ct=()=>Math.min(window.innerWidth/22,window.innerHeight/12);window.tileSize=Ct(),window.addEventListener("resize",()=>{Et.width=window.innerWidth,Et.height=window.innerHeight,window.tileSize=Ct()});const Dt=Et.getContext("2d");window.mapLoader=(t=>{const e=[vt,zt,_t];let i=-1;return{unload:()=>{At(t)},init:()=>{At(t),i=0,t.select(nt).iterate(t=>{t.get(nt).hp=100}),kt(e[i],t)},next:()=>{At(t),i++,i<e.length&&kt(e[i],t)}}})(B),B.register($,G,J,Z,K,Q,nt,it,V,ot,lt,rt,et,ct,st,ht,ft,dt,tt,yt),B.process(((t,e)=>{const i=t.select($,tt),s=t.select(lt);return{update:t=>{(t=>{t.fillStyle="#522906",t.fillRect(0,0,22*tileSize,12*tileSize)})(e),i.iterate(t=>{const i=t.get($),s=t.get(tt);s.draw(i.clone().multiplyScalar(tileSize),e,s)}),s.iterate(t=>{const i=t.get(lt);e.fillStyle="#030917",e.fillRect(i.x*tileSize,i.y*tileSize,tileSize,tileSize)}),s.list&&(e.fillRect(0,0,22*tileSize,tileSize),e.fillRect(0,11*tileSize,22*tileSize,tileSize),e.fillRect(0,0,tileSize,12*tileSize),e.fillRect(21*tileSize,0,tileSize,12*tileSize))}}})(B,Dt),((t,e)=>{const i=t.select(K,$),s=t.select(V);return{update:()=>{let t=-1;s.iterate(e=>{t+=e.get(V).remaining()}),i.iterate(i=>{const s=i.get(K),n=i.get($);e.textAlign="center",e.font="50px sans-serif",e.fillStyle="rgba(100, 170, 220)";const o=s.sc.replace("%remain",t);e.fillStyle="#9E622B",e.fillText(o,n.x*tileSize,n.y*tileSize)})}}})(B,Dt),(t=>{const e=t.select($,Z,J,G),i=t.select(ct);let s=!0;return{update:n=>{e.iterate(e=>{const{isUp:n,isDown:o,isLeft:r,isRight:l,isMain:a}=e.get(Z),c=e.get($),h=e.get(G),f=e.get(J);f.setScalar(0),n?f.setY(-.01):h.y<0&&!o&&h.setY(Y(.02+h.y,-Number.MAX_VALUE,0)),o?f.setY(.01):h.y>0&&!n&&h.setY(Y(-.02+h.y,0,Number.MAX_VALUE)),r?f.setX(-.01):h.x<0&&!l&&h.setX(Y(.02+h.x,-Number.MAX_VALUE,0)),l?f.setX(.01):h.x>0&&!r&&h.setX(Y(-.02+h.x,0,Number.MAX_VALUE)),h.add(f).clampScalar(-1/8,1/8),a||s||(s=!0),a&&s&&(s=!1,i.iterate(e=>{const i=e.get(ct);if(i.isAvailable()){const e=i.useBomb();t.create().add(e,new $(c.x+.5,c.y+.5,0),new tt(U))}}))})}}})(B),((t,e)=>{const i=t.select(Q),s=t.select(it,$),n=t.select(nt),o=t.select(yt,$);return{update:r=>{i.iterate(i=>{const l=i.get(Q),a=i.get($);switch(l.remaining-=r,((t,e,i)=>{switch(i.lineWidth=2,t.type){case 0:i.strokeStyle="#ffbd18";break;case 2:i.strokeStyle="#fff";break;case 1:i.strokeStyle="#00f";break;case 3:i.strokeStyle="#f00";break;case 4:i.strokeStyle="#0f0"}const s=t.radius*tileSize+5;i.beginPath(),i.moveTo(e.x+s*Math.cos(0),e.y+s*Math.sin(0));for(let t=1;t<=16;t++)i.lineTo(e.x+s*Math.cos(2*t*Math.PI/16),e.y+s*Math.sin(2*t*Math.PI/16));i.lineWidth=1,i.closePath(),i.stroke(),i.beginPath(),i.arc(e.x,e.y,t.radius*tileSize/2,-Math.PI/2,-Math.PI/2+(t.total-t.remaining)/t.total*I),i.strokeStyle="rgba(255, 255, 255, .3)",i.lineWidth=tileSize/2,i.stroke()})(l,a.clone().multiplyScalar(tileSize),e),l.type){case 0:case 1:case 2:case 3:case 4:l.remaining<0?(l.triggered=!1,l.isArmed=!1,i.eject(),o.iterate(t=>{const e=t.get($),i=t.get(yt);e.distance2D(a)<l.radius&&(i.exploded=!0)}),s.iterate(e=>{const i=e.get($),s=e.get(G),n=e.get(it);3===n.effect&&(n.effect=-1,n.effectTime=0),i.distance2D(a)<l.radius&&(1===l.type?(n.effect=0,n.freezeTime=1100):2===l.type?(n.effect=1,n.effectTime=3300):(n.isActive=!1,n.effect=!1,s.setScalar(0),t.create().add(new tt(H),new et(performance.now()),new $(i.x,i.y,i.z))))}),t.create().add(new $(a.x,a.y,a.z),new dt(l.type))):3===l.type&&!1===l.triggered?s.iterate(t=>{const e=t.get($);t.get(G),t.get(it);e.distance2D(a)<l.radius&&(l.triggered=!0,l.remaining=200)}):4===l.type&&!1===l.triggered&&n.iterate(t=>{const e=t.get($),s=(t.get(G),e.clone().addScalar(.5));if(s.distance2D(a)<.5&&l.isArmed&&!i.get(G)){const t=a.clone().sub(s).normalise().multiplyScalar(.1);i.add(new G(t.x,t.y,t.z),new rt(0,0,.4,.4))}s.distance2D(a)>1&&(l.isArmed=!0)})}})}}})(B,Dt),((t,e)=>{const i=t.select(V);return{update:t=>{i.iterate(i=>{const s=i.get($),n=i.get(V);n.cd-=t,n.cd<=0&&n.total>0&&n.hasOne()?(n.cd=1e3,n.active(s),n.total--):n.cd>0&&n.total>0&&(e.beginPath(),e.closePath(),e.fillStyle="rgba(255, 255, 255, .3)",e.fill()),e.fillStyle="#000",e.fillRect(s.x*tileSize,s.y*tileSize,tileSize,tileSize)})}}})(B,Dt),((t,e)=>{const i=t.select($,it),s=t.select($,nt),n=t.select(lt);return{update:e=>{const o=[];for(let t=0;t<22;t++){o[t]=[];for(let e=0;e<12;e++)o[t].push(1)}n.iterate(t=>{const e=t.get(lt);o[e.x][e.y]=0,e.x<22&&(o[e.x+1][e.y]=0),e.x>0&&(o[e.x-1][e.y]=0),e.y<12&&(o[e.x][e.y+1]=0),e.y>0&&(o[e.x][e.y-1]=0),o[e.x][e.y]=0});const r=new St(o);s.iterate(s=>{const n=s.get($);i.iterate(i=>{const s=i.get(it);if(s.effect&&(s.effectTime-=e),s.effectTime<0&&s.effect&&(s.effect=!1),3===s.effect){i.get($).distance2D(n)<5&&(s.effect=-1,s.effectTime=0)}if(s.isActive&&3!==s.effect){const e=i.get($),o=i.get(G);if(s.isAttacking||0===s.effect)o.setScalar(0);else if(1===s.effect);else if(0===s.type||1===s.type&&e.distance2D(n)>7){let t,i=[];e&&(i=mt.search(r,r.grid[Math.floor(n.x+.5)][Math.floor(n.y+.5)],r.grid[Math.floor(e.x)][Math.floor(e.y)])),t=i.length>1?new $(i[i.length-2].x+.5,i[i.length-2].y+.5,0):n.clone();const s=t.sub(e);o.set(s.normalise().multiplyScalar(.07))}else o.setScalar(0);s.isAttacking||4===s.effect||(n.distance2D(e)<1&&0===s.type&&-1!==s.effect?(s.isAttacking=!0,t.create().add(new st(s,500,0),new $(e.x+.5,e.y+.5,e.z))):s.isAttacking||1!==s.type||(s.isAttacking=!0,t.create().add(new st(s,500,1),new $(e.x+.5,e.y+.5,e.z))))}})})}}})(B),((t,e)=>{const i=t.select(ft,$),s=t.select(nt,$),n=t.select(it),o=t.select(yt);let r,l;return{update:()=>{r=0,n.iterate(t=>{r+=t.get(it).isActive?1:0}),l=0,o.iterate(t=>{l+=t.get(yt).exploded?0:1}),s.iterate(t=>{const s=t.get($);i.iterate(t=>{const i=t.get($),n=0===r&&0===l;switch(e.fillStyle=n?"#31cd39":"#9e333d",i.x){case 0:e.fillRect(5*tileSize,0*tileSize,4*tileSize,tileSize);break;case 1:if(e.fillRect(21*tileSize,4*tileSize,tileSize,4*tileSize),n&&((t,e,i)=>t.x+1>e.x&&t.x<e.x+i.x&&t.y+1>e.y&&t.y<e.y+i.y)(s,new L(21,3),new L(1,4))&&(window.mapLoader.next(),s.x=1),n){const t=new $(19*tileSize,5*tileSize+tileSize/2);e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.x+tileSize,t.y),e.lineTo(t.x+tileSize,t.y-tileSize/2),e.lineTo(t.x+2*tileSize,t.y+tileSize/2),e.lineTo(t.x+tileSize,t.y+tileSize+tileSize/2),e.lineTo(t.x+tileSize,t.y+tileSize),e.lineTo(t.x,t.y+tileSize),e.fill()}break;case 2:e.fillRect(5*tileSize,11*tileSize,4*tileSize,tileSize);break;case 3:e.fillRect(0*tileSize,3*tileSize,tileSize,4*tileSize)}})})}}})(B,Dt),((t,e)=>{const i=t.select(rt,G,$),s=t.select(lt);let n=!1;return{update:()=>{i.iterate(t=>{const e=t.get($),i=t.get(G);if(0===i.x&&0===i.y)return;const o=t.get(rt);e.x+o.xMin<1&&(e.x=1-o.xMin,i.x=-i.x),e.y+o.yMin<1&&(e.y=1-o.yMin,i.y=-i.y),e.x+o.xMax>21&&(e.x=21-o.xMax,i.x=-i.x),e.y+o.yMax>11&&(e.y=11-o.yMax,i.y=-i.y),n=!1,s.iterate(t=>{const s=t.get(lt),r=e.clone();r.add(i),r.x+o.xMax>s.x&&r.x+o.xMax<s.x+1?r.y+o.yMax>s.y&&r.y+o.yMax<s.y+1?i.angle()<new L(r.x+o.xMax-s.x,r.y+o.yMax-s.y).angle()?(e.x=s.x-o.xMax,e.y+=i.y*((r.x-e.x)/i.x),i.x=-i.x,n=!0):(e.y=s.y-o.yMax,e.x+=i.x*((r.y-e.y)/i.y),i.y=-i.y):r.y+o.yMin>s.y&&r.y+o.yMin<s.y+1&&(i.angle()>new L(r.x+o.xMax-s.x,r.y+o.yMax-(s.y+1)).angle()?(e.y=s.y+o.xMax,e.x+=i.x*((r.y-e.y)/i.y),i.y=-i.y,n=!0):(e.x=s.x-o.xMax,e.y+=i.y*((r.x-e.x)/i.x),i.x=-i.x,n=!0)):r.x+o.xMin>s.x&&r.x+o.xMin<s.x+1&&(r.y+o.yMax>s.y&&r.y+o.yMax<s.y+1?i.angle()>new L(r.x+o.xMin-(s.x+1),r.y+o.yMax-s.y).angle()?(e.x=s.x+1+o.xMin,e.y+=i.y*((r.x-e.x)/i.x),i.x=-i.x,n=!0):(e.y=s.y-o.yMax,e.x+=i.x*((r.y-e.y)/i.y),i.y=-i.y,n=!0):r.y+o.yMin>s.y&&r.y+o.yMin<s.y+1&&(i.angle()<new L(r.x+o.xMin-(s.x+1),r.y+o.yMin-(s.y+1)).angle()?(e.x=s.x+o.xMax,e.y+=i.y*((r.x-e.x)/i.x),i.x=-i.x,n=!0):(e.y=s.y+o.yMax,e.x+=i.x*((r.y-e.y)/i.y),i.y=-i.y,n=!0)))}),n||e.add(i)})}}})(B),((t,e,i)=>{const s=new L(11*i-300,12*i-50),n=t.select(ct);return{update(t){n.iterate(i=>{const n=i.get(ct);n.rollTime+=t,n.rollTime>2e3&&n.isRolling&&n.roll();for(let t=1;t<=n.bombSlots.length;t++){let i=n.bombSlots[t-1];O(s,i,t,e,n.isRolling,n.rollTime/2e3)}!n.isAvailable()&&n.isAllExploded()&&!n.isRolling&&n.canRoll&&n.initRoll()})}}})(B,Dt,tileSize),((t,e)=>{const i=t.select(et,$);return{update:()=>{i.iterate(t=>{const i=t.get($);t.get(et);H(i,e)})}}})(B,Dt),((t,e)=>{const i=t.select(dt,$);return{update:t=>{i.iterate(i=>{const s=i.get(dt);if(s.remaining-=t,s.remaining<0)i.eject();else{const t=i.get($);switch(s.bombType){case 0:case 4:case 3:s.points.forEach(i=>{e.beginPath(),e.arc(i.x+t.x*tileSize,i.y+t.y*tileSize,.5*tileSize,0,I),e.fillStyle=`rgba(255,255,255,${1-s.remaining/300})`,e.fill(),i.multiplyScalar(1.33)});break;case 1:e.beginPath(),e.arc(t.x*tileSize,t.y*tileSize,2*tileSize,0,I),e.fillStyle=`rgba(0,0,255,${1-s.remaining/300})`,e.fill();break;case 2:e.beginPath(),e.arc(t.x*tileSize,t.y*tileSize,2*tileSize,0,I),e.fillStyle="rgba(255,255,255, 1)",e.fill()}switch(s.bombType){case 0:case 3:case 4:const i=s.remaining/300;e.beginPath(),e.arc(t.x*tileSize,t.y*tileSize,(1+i)*tileSize*2,0,I),e.strokeStyle=`rgba(255,255,255,${.5*i})`,e.lineWidth=4,e.stroke(),e.beginPath(),e.arc(t.x*tileSize,t.y*tileSize,(1-i)*tileSize*3,0,I),e.stroke()}}})}}})(B,Dt),((t,e)=>{const i=t.select(yt,$);return{update:t=>{i.iterate(t=>{const i=t.get($),s=t.get(yt);s.blink++,((t,e,i)=>{t.fillStyle="#040B0F",t.fillRect(e.x*tileSize,e.y*tileSize,tileSize,tileSize),t.beginPath(),t.rect(e.x*tileSize+2,e.y*tileSize+2,tileSize-4,tileSize-4),t.strokeStyle=i.exploded?"#444":"#C21111",t.lineWidth=1,t.stroke(),t.beginPath(),t.rect(e.x*tileSize-10,e.y*tileSize-10,tileSize+20,tileSize+20),t.strokeStyle="#9E4D06",t.lineWidth=2,t.stroke()})(e,i,s)})}}})(B,Dt),((t,e,i)=>{const s=t.select(st),n=t.select(nt),o=(t.select(ct),t.select(lt));return{update:i=>{s.iterate(s=>{const r=s.get(st),l=s.get($);if(0===r.type){e.beginPath(),e.arc(l.x*tileSize,l.y*tileSize,2*tileSize,0,I),e.lineWidth=2,e.closePath(),e.strokeStyle="#971313",e.stroke();const o=2*tileSize,h=2*o/17;var a=Math.cos(1),c=Math.sin(1);for(let t=0;t<16;t++){const i=h*(t+1)-o,s=Math.sqrt(o*o-i*i),n=i*c+s*a+l.x*tileSize,r=i*c-s*a+l.x*tileSize,f=i*a-s*c+l.y*tileSize,d=i*a+s*c+l.y*tileSize;e.beginPath(),e.moveTo(n,f),e.lineTo(r,d),e.stroke()}e.beginPath(),e.fillStyle="rgba(245, 88, 21, .3)",e.arc(l.x*tileSize,l.y*tileSize,(1-r.remaining/500)*tileSize*2,0,I),e.fill(),r.remaining-=i,r.remaining<0&&(n.iterate(t=>{const e=t.get($),i=t.get(nt);l.distance2D(e)<2&&(i.hp-=15)}),r.hostile.isAttacking=!1,s.eject(),t.create().add(new $(l.x,l.y,l.z),new ht(performance.now())))}else{let t=!1;e.fillStyle=`rgba(255, 0, 0, ${1-r.remaining/500})`;let a,c,h=!1;r.remaining-=i,r.remaining<0&&(n.iterate(t=>{a=t.get($),c=t.get(nt),h=!0,s.eject()}),s.eject(),r.hostile.isAttacking=!1,r.hostile.effect=4,r.hostile.effectTime=3e3);for(let i=Math.floor(l.x);i<22&&!t;i++)!h||Math.floor(a.x)!==i||Math.floor(a.y)!==Math.floor(l.y)&&Math.floor(a.y+1)!==Math.floor(l.y)||(c.hp-=15),e.fillRect(i*tileSize,Math.floor(l.y)*tileSize,tileSize,tileSize),o.iterate(e=>{const s=e.get(lt);i+1===s.x&&Math.floor(l.y)===s.y&&(t=!0)});t=!1;for(let i=Math.floor(l.x);i>0&&!t;i--)!h||Math.floor(a.x)!==i||Math.floor(a.y)!==Math.floor(l.y)&&Math.floor(a.y+1)!==Math.floor(l.y)||(c.hp-=15),e.fillRect(i*tileSize,Math.floor(l.y)*tileSize,tileSize,tileSize),o.iterate(e=>{const s=e.get(lt);i===s.x+1&&Math.floor(l.y)===s.y&&(t=!0)})}})}}})(B,Dt),((t,e)=>{const i=t.select(ht);return{update:t=>{i.iterate(t=>{const i=t.get(ht);if(performance.now()-i.at>300)return void t.eject();const s=t.get($);e.beginPath(),e.fillStyle="rgba(200, 30, 30, .7)",e.arc(s.x*tileSize,s.y*tileSize,2*tileSize,0,I),e.closePath(),e.fill()})}}})(B,Dt),((t,e,i)=>{const s=t.select(ot);return{update:()=>{s.iterate(t=>{const s=t.get(ot);s.isHover&&(e.fillStyle="rgba(255, 255, 255, 0.3)",e.fillRect(0,s.y-10,i.width,120)),e.font=tileSize+"px Arial",s.isButton?(e.fillStyle="#fff",e.fillRect(s.x,s.y,300,100),e.textAlign="center",e.fillStyle="#000",e.fillText(s.text,s.x+150,s.y+60)):(e.fillStyle="#000",e.fillText(s.text,s.x+150,s.y+50))})}}})(B,Dt,Et),((t,e,i)=>{const s=t.select(nt),n=new L(11*tileSize-210,10);return{update:()=>{s.iterate(s=>{const o=s.get(nt);o.hp<=0&&window.currentScreen.isGame?(mapLoader.unload(t),window.currentScreen.unload(),window.currentScreen=((t,e,i)=>({isGame:!1,load:()=>{t.create().add(new ot("You died",i.width/2-150,i.height/2,()=>{},!1)),t.create().add(new ot("Restart",i.width/2-150,i.height/2+150,()=>{window.currentScreen.unload(),window.currentScreen=pt(t),window.mapLoader.init()},!0))},unload:()=>{ut(t)}}))(t,tileSize,i),window.currentScreen.load()):(e.fillStyle="#000",e.fillRect(n.x,n.y,420,50),e.fillStyle="red",e.fillRect(n.x+10,n.y+10,4*o.hp,30),e.font="400 22px Arial",e.fillStyle="#000",e.fillText("HP",n.x+17,n.y+35),e.fillStyle="#fff",e.fillText("HP",n.x+15,n.y+33))})}}})(B,Dt,Et)),(async()=>{const t=await(async t=>{const e=await p(t),i=u.createBufferSource();return i.buffer=e,i.connect(u.destination),t=>(i.loop=t,i.start(),i)})(g);let e=null,i=!1;Et.onclick=()=>{i||(e=t(!0),i=!0)},s.onclick=()=>{e.stop()}})(),window.currentScreen=xt(B,Et),xt(B,Et).load();let Rt,Pt=0;const jt=()=>{Rt=performance.now(),Et.width+=0,B.update(Rt-Pt),Pt=Rt,requestAnimationFrame(jt)};jt()}]);