!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t){t.exports=JSON.parse('{"compressionlevel":-1,"editorsettings":{"export":{"format":"json","target":"welcome.json"}},"height":12,"infinite":false,"layers":[{"draworder":"topdown","id":2,"name":"Calque d\'Objets 1","objects":[{"height":0,"id":1,"name":"","point":true,"properties":[{"name":"isStart","type":"bool","value":true}],"rotation":0,"type":"","visible":true,"width":0,"x":4.78233,"y":6.00282},{"height":19,"id":2,"name":"","properties":[{"name":"doors","type":"int","value":2}],"rotation":0,"text":{"fontfamily":"MS Shell Dlg 2","pixelsize":3,"text":"Move with zqsd or wasd","wrap":true},"type":"","visible":true,"width":108,"x":10.8364124533512,"y":3.23700909714668},{"height":0,"id":3,"name":"","point":true,"properties":[{"name":"isSpawn","type":"bool","value":true},{"name":"max","type":"int","value":2},{"name":"total","type":"int","value":4}],"rotation":0,"type":"","visible":true,"width":0,"x":15.1117,"y":7.05213}],"opacity":1,"type":"objectgroup","visible":true,"x":0,"y":0},{"data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"height":12,"id":1,"name":"Calque de Tuiles 1","opacity":1,"type":"tilelayer","visible":true,"width":22,"x":0,"y":0}],"nextlayerid":3,"nextobjectid":4,"orientation":"orthogonal","renderorder":"left-up","tiledversion":"1.4.1","tileheight":1,"tilesets":[{"firstgid":1,"source":"../../../../../../Desktop/aos.tsx"}],"tilewidth":1,"type":"map","version":1.4,"width":22}')},function(t){t.exports=JSON.parse('{"compressionlevel":-1,"editorsettings":{"export":{"format":"json","target":"home.json"}},"height":12,"infinite":false,"layers":[{"draworder":"topdown","id":2,"name":"Calque d\'Objets 1","objects":[{"height":0,"id":1,"name":"","point":true,"properties":[{"name":"isRed","type":"bool","value":true},{"name":"status","type":"string","value":"sleep"}],"rotation":0,"type":"","visible":true,"width":0,"x":12.9536011080332,"y":7.89127423822715}],"opacity":1,"type":"objectgroup","visible":true,"x":0,"y":0},{"data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"height":12,"id":1,"name":"Calque de Tuiles 1","opacity":1,"type":"tilelayer","visible":true,"width":22,"x":0,"y":0}],"nextlayerid":3,"nextobjectid":2,"orientation":"orthogonal","renderorder":"right-down","tiledversion":"1.4.2","tileheight":1,"tilesets":[{"firstgid":1,"source":"aos.tsx"}],"tilewidth":1,"type":"map","version":1.4,"width":22}')},function(t){t.exports=JSON.parse("{}")},function(t,e,i){"use strict";i.r(e);const s=Math;function n(t){return s.sin(6.283184*t)}var r=[n,function(t){return n(t)<0?-1:1},function(t){return t%1-.5},function(t){var e=t%1*4;return e<2?e-1:3-e}];function a(t){return.00390625*s.pow(1.059463094,t-128)}function l(t){return{left:new Float32Array(t),right:new Float32Array(t)}}function o(t,e,i,s){for(var n=i.fx_delay_time*s>>1,r=i.fx_delay_amt/255,a=0;a<e-n;){var l=a,o=a+n;t.left[o]+=t.right[l]*r,t.right[o]+=t.left[l]*r,a++}}function c(t,e){var i=t.createBuffer(2,e.left.length,44100);return i.getChannelData(0).set(e.left),i.getChannelData(1).set(e.right),i}var h=function(t,e,i){this.ctx=t,this.instr=e,this.rowLen=i||5605,this.osc_lfo=r[e.lfo_waveform],this.osc1=r[e.osc1_waveform],this.osc2=r[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=s.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=s.pow(2,e.lfo_freq-8)/this.rowLen};h.prototype._genSound=function(t,e,i){for(var r=0,l=0,o=a(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),c=a(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),h=this.instr.fx_resonance/255,d=0,y=0,f=e.left.length,u=this.attack+this.sustain+this.release-1;u>=0;--u){var x=u+i,p=this.osc_lfo(x*this.lfoFreq)*this.instr.lfo_amt/512+.5,g=1;u<this.attack?g=u/this.attack:u>=this.attack+this.sustain&&(g-=(u-this.attack-this.sustain)/this.release);var m=o;this.instr.lfo_osc1_freq&&(m+=p),this.instr.osc1_xenv&&(m*=g*g),r+=m;var S=this.osc1(r)*this.instr.osc1_vol;m=c,this.instr.osc2_xenv&&(m*=g*g),l+=m,S+=this.osc2(l)*this.instr.osc2_vol,this.instr.noise_fader&&(S+=(2*s.random()-1)*this.instr.noise_fader*g),S*=g/255;var w=this.instr.fx_freq;this.instr.lfo_fx_freq&&(w*=p);var b=h*(S-y)-(d+=(w=1.5*s.sin(3.141592*w/44100))*y);switch(y+=w*b,this.instr.fx_filter){case 1:S=b;break;case 2:S=d;break;case 3:S=y;break;case 4:S=d+b}m=n(x*this.panFreq)*this.instr.fx_pan_amt/512+.5,S*=.00476*this.instr.env_master,x<f&&(e.left[x]+=S*(1-m),e.right[x]+=S*m)}},h.prototype._createAudioBuffer=function(t,e){var i=this.attack+this.sustain+this.release-1+32*this.rowLen,s=l(i);this._genSound(t,s,0),o(s,i,this.instr,this.rowLen),e(c(this.ctx,s))};var d=function(t,e){this.ctx=t,this.song=e,this.waveSize=44100*e.songLen};d.prototype._generateTrack=function(t,e,i){var s=l(this.waveSize),n=this.waveSize,r=this.song.rowLen,a=this.song.endPattern,c=new h(this.ctx,t,r),d=0,y=0,f=0,u=function(){for(var e=Date.now();;)if(32!==f){if(y===a-1)return x();var i=t.p[y];if(i){var n=t.c[i-1].n[f];n&&c._genSound(n,s,d)}if(d+=r,f+=1,Date.now()-e>33)return void setTimeout(u,0)}else f=0,y+=1},x=function(){o(s,n,t,r);for(var a=0;a<n;a++)e.left[a]+=s.left[a];for(a=0;a<n;a++)e.right[a]+=s.right[a];i()};u()},d.prototype._createAudioBuffer=function(t){var e=this,i=l(this.waveSize),s=0,n=function(){s<e.song.songData.length?(s+=1,e._generateTrack(e.song.songData[s-1],i,n)):t(c(e.ctx,i))};n()};new(window.webkitAudioContext||window.AudioContext);i(2);var f=[],u=[],p={},g="_sign",m="_mask";"undefined"!=typeof Symbol&&(g=Symbol(g),m=Symbol(m));var S=function(t,e){var i=e[t];if(!i)throw new Error("The component is not registered");return i},w=S.bind(null,g),b=S.bind(null,m),v=function(t){t.id&&f.forEach((function(e){return e.match(t)}))},M=1,k={},_=function(t){this.id=t||(M++).toString(36),this.components=Object.assign({},k),this.mask=0};_.prototype.add=function(){for(var t=this,e=[],i=arguments.length;i--;)e[i]=arguments[i];e.forEach((function(e){t.components[w(e.constructor)]=e,t.mask|=b(e.constructor)})),v(this)},_.prototype.remove=function(){for(var t=this,e=[],i=arguments.length;i--;)e[i]=arguments[i];e.forEach((function(e){var i=w(e),s=t.components[i];s&&(s.destructor&&s.destructor(),delete t.components[i],t.mask&=~b(e))})),v(this)},_.prototype.has=function(t){return w(t)in this.components},_.prototype.get=function(t){return this.components[t[g]]},_.prototype.eject=function(){!function(t){var e=t.components;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=e[i];s&&s.destructor&&s.destructor()}f.forEach((function(e){return e.remove(t)})),delete p[t.id],t.id=0}(this)};var A=function(t,e){this.entity=t,this.prev=null,this.next=e},R=function(t){if(!t)throw new Error("Empty selector");for(var e in this.mask=t,this.map={},this.list=null,this.length=0,p)Object.prototype.hasOwnProperty.call(p,e)&&this.match(p[e])};R.prototype.iterate=function(t){for(var e=this.list;e;)t(e.entity),e=e.next},R.prototype.match=function(t){(this.mask&t.mask)===this.mask?this.add(t):this.remove(t)},R.prototype.add=function(t){if(!this.map[t.id]){var e=new A(t,this.list);this.list&&(this.list.prev=e),this.list=e,this.map[t.id]=e,this.length++}},R.prototype.remove=function(t){var e=this.map[t.id];e&&(e.prev?e.prev.next=e.next:this.list=e.next,e.next&&(e.next.prev=e.prev),delete this.map[t.id],this.length--)};var P=0,D=performance||Date,E=D.now.bind(D),j={register:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach((function(t){if(P>31)throw new Error("Components limit reached");if(!t[g]){var e=P.toString(36);k[e]=null,t[g]=e,t[m]=1<<P,P++}}))},process:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach((function(t){return u.push(t)}))},create:function(t){var e=new _(t);if(p[e.id])throw new Error("The ID already exist");return p[e.id]=e,e},get:function(t){return p[t]},select:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var i=0;t.forEach((function(t){i|=b(t)}));for(var s=0;s<f.length;s++)if(f[s].mask===i)return f[s];var n=new R(i);return f.push(n),n},update:function(t){var e={};return u.forEach((function(i){var s=E();i.update(t),e[i.constructor.name]=E()-s})),e}};class T{constructor(t,e,i){this.x=t,this.y=e,this.z=i}setX(t){this.x=t}setY(t){this.y=t}setZ(t){this.z=t}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}dot2D(t){return this.x*t.x+this.y*t.y}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}setScalar(t){return this.x=t,this.y=t,this.z=t,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}clone(){return new T(this.x,this.y,this.z)}distance2D(t){return Math.hypot(this.x-t.x,this.y-t.y)}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}normalise(){return this.divideScalar(this.length())}set(t){this.x=t.x,this.y=t.y,this.z=t.z}toString(){return`${x} ${y} ${z}`}}const C=(t,e,i)=>{t.beginPath(),t.arc(e,i,4,0,F),t.closePath(),t.fill()},L=(t,e,i,s,n,r)=>{switch(s.fillStyle="#000",s.fillRect(t.x+105*i,t.y,100,100),s.fillStyle=e.isAvailable?"rgba(30, 130, 30, 1)":"rgba(200, 30, 30, 1)",s.fillRect(t.x+105*i+10,t.y+10,80,80),n&&(s.fillStyle="rgba(30, 130, 30, 1)",s.fillRect(t.x+105*i+10,t.y+10,80*r,80)),s.fillStyle="#000",e.type){case 0:C(s,t.x+105*i+50,t.y+50);break;case 1:C(s,t.x+105*i+30,t.y+30),C(s,t.x+105*i+70,t.y+70);break;case 2:C(s,t.x+105*i+30,t.y+30),C(s,t.x+105*i+50,t.y+50),C(s,t.x+105*i+70,t.y+70);break;case 3:C(s,t.x+105*i+30,t.y+30),C(s,t.x+105*i+70,t.y+30),C(s,t.x+105*i+30,t.y+70),C(s,t.x+105*i+70,t.y+70);break;case 4:C(s,t.x+105*i+50,t.y+50),C(s,t.x+105*i+30,t.y+30),C(s,t.x+105*i+70,t.y+30),C(s,t.x+105*i+30,t.y+70),C(s,t.x+105*i+70,t.y+70);break;case 5:C(s,t.x+105*i+30,t.y+30),C(s,t.x+105*i+30,t.y+50),C(s,t.x+105*i+30,t.y+70),C(s,t.x+105*i+70,t.y+30),C(s,t.x+105*i+70,t.y+50),C(s,t.x+105*i+70,t.y+70)}},O=(t,e,i)=>{e.fillStyle="#fff",e.fillRect(t.x,t.y,1*tileSize,1*tileSize),e.fillStyle="#00f",e.fillRect(t.x+2,t.y+2,1*tileSize-4,1*tileSize-4)},q=(t,e,i)=>{e.fillStyle="#fff",e.fillRect(t.x,t.y,1*tileSize,1*tileSize),e.fillStyle="#f00",e.fillRect(t.x+2,t.y+2,1*tileSize-4,1*tileSize-4)},X=(t,e,i)=>{e.fillStyle="#fff",e.fillRect(t.x*tileSize,t.y*tileSize,1*tileSize,1*tileSize),e.fillStyle="#000",e.fillRect(t.x*tileSize+2,t.y*tileSize+2,1*tileSize-4,1*tileSize-4)},U=(t,e,i)=>{e.fillStyle="#fff",e.beginPath(),e.arc(t.x,t.y,.5*tileSize,0,F),e.closePath(),e.fill(),e.fillStyle="#000",e.beginPath(),e.arc(t.x,t.y,.5*tileSize-2,0,F),e.closePath(),e.fill()},B=(t,e,i)=>Math.max(e,Math.min(i,t)),F=2*Math.PI,H=(t,e,i,s)=>{const n=t.create();return n.add(new K(null,null,i,s),new I(e.x,e.y,e.z),new J(q),new N(0,0,0),new it(0,0,1,1)),n};class I extends T{}class N extends T{}class Y extends T{}class W{constructor(t,e,i){this.cd=1e3,this.maxHostiles=e,this.total=i,this.hostiles=[];for(let e=0;e<this.maxHostiles;e++)this.hostiles.push(H(t,new I(0,0,0),!1))}remaining(){let t=0;for(let e=0;e<this.hostiles.length;e++)this.hostiles[e].get(K).isActive&&t++;return this.total+t}hasOne(){for(let t=0;t<this.hostiles.length;t++)if(!1===this.hostiles[t].get(K).isActive)return this.hostiles[t];return!1}active(t){const e=this.hasOne();e&&(e.get(K).isActive=!0,e.get(I).set(t))}}class ${constructor(){this.isUp=!1,this.isLeft=!1,this.isRight=!1,this.isDown=!1,this.isMain=!1,window.addEventListener("keydown",t=>{90!==t.keyCode&&87!==t.keyCode||(this.isUp=!0),32===t.keyCode&&(this.isMain=!0),81!==t.keyCode&&65!==t.keyCode||(this.isLeft=!0),68===t.keyCode&&(this.isRight=!0),83===t.keyCode&&(this.isDown=!0)}),window.addEventListener("keyup",t=>{90!==t.keyCode&&87!==t.keyCode||(this.isUp=!1),32===t.keyCode&&(this.isMain=!1),81!==t.keyCode&&65!==t.keyCode||(this.isLeft=!1),68===t.keyCode&&(this.isRight=!1),83===t.keyCode&&(this.isDown=!1)})}}class V{constructor(t){this.sc=t}}class G{constructor(t,e,i){this.triggered=!1,this.armed=!1,this.type=t,this.remaining=e,this.total=e,this.radius=i}}class J{constructor(t){this.draw=t}}class Z{constructor(t){this.diedAt=t}}class K{constructor(t,e,i,s){this.status=s,this.target=t,this.isActive=i,this.type=e,this.isAttacking=!1,this.effect=null,this.effectTime=0}}class Q{constructor(t,e){this.hostile=t,this.at=e}}class tt{constructor(){this.hp=100}}class et{constructor(t,e,i,s,n){this.text=t,this.x=e,this.y=i,this.isButton=n,this.add=t=>{Math.abs(t.pageX-e)<100&&Math.abs(t.pageY-i)<100&&s()},window.addEventListener("mousedown",this.add)}destructor(){window.removeEventListener("mousedown",this.add)}}class it{constructor(t,e,i,s){this.xMin=t,this.yMin=e,this.xMax=i,this.yMax=s}}class st extends T{}class nt{constructor(t){this.cd=t,this.isAvailable=!0,this.isDisabled=!1,this.roll(),this.bomb=null}use(){return this.bomb=new G(this.type,3===this.type||4===this.type?1e4:2500,3),this.isAvailable=!1,this.bomb}roll(){this.type=Math.floor(5*Math.random()),this.isAvailable=!0}}class rt{constructor(t,e){this.maxSize=t,this.disabled=0,this.bombSlots=[],this.isRolling=!1,this.rollAt=-1;for(let i=0;i<t;i++)this.bombSlots.push(new nt(e))}isAvailable(){for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isAvailable&&!this.bombSlots[t].isDisabled)return!0;return!1}isAllExploded(){for(let t=0;t<this.bombSlots.length;t++)if(!this.bombSlots[t].bomb)return!1;for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].bomb.timer>0)return!1;return!0}useBomb(){for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isAvailable&&!this.bombSlots[t].isDisabled)return this.bombSlots[t].use()}initRoll(){this.isRolling=!0,this.rollTime=0}roll(){this.isRolling=!1;for(let t=0;t<this.bombSlots.length;t++)this.bombSlots[t].isDisabled||this.bombSlots[t].roll()}disable(t,e){this.disabled++,this.disabled,this.maxSize;for(let t=0;t<this.bombSlots.length;t++)if(!this.bombSlots[t].isDisabled)return void(this.bombSlots[t].isDisabled=!0)}enable(){this.disabled--;for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isDisabled)return void(this.bombSlots[t].isDisabled=!1)}}class at{constructor(t){this.at=t}}class lt{constructor(t){this.to=t,this.timer=-1}}class ot{constructor(t){this.remaining=300,this.points=[],this.bombType=t;for(let t=0;t<9;t++){const t=Math.random()*F;this.points.push(new T(Math.cos(t),Math.sin(t)))}}}class ct{constructor(){this.blink=0,this.exploded=!1}}const ht=(t,e)=>({isGame:!1,load:()=>{t.create().add(new et("Start",e.width/2,e.height/2,()=>{window.currentScreen.unload(),window.currentScreen=dt(t).load()},!0))},unload:()=>{t.select(et).iterate(t=>{t.eject()})}}),dt=t=>({isGame:!0,load:()=>{window.mapLoader.next(t)},unload:()=>{window.mapLoader.unload(t)}});var yt=i(0),ft=i(1);const ut=(t,e,...i)=>e.reduce((e,s)=>(s.properties.find(e=>e.name===t)&&e.push({x:s.x,y:s.y,...s.properties.reduce((t,e)=>(-1!==i.indexOf(e.name)&&(t[e.name]=e.value),t),{})}),e),[]),xt=(t,e,i)=>{const s=t.layers[0].objects,n=ut("isStart",s);if(n.length>0){const t=new I(n[0].x,n[0].y);((t,e)=>{t.create().add(new rt(3,3e3)),t.create().add(new J(O),new I(e.x,e.y,e.z),new N(0,0,0),new Y(0,0,0),new $,new tt,new it(0,0,1,1))})(e,new I(t.x,t.y,0))}e.create().add(new lt,new I(1));ut("isSpawn",s,"max","total").forEach(t=>{e.create().add(new W(e,t.max,t.total),new I(t.x,t.y,0))});ut("isRed",s,"status").forEach(t=>{H(e,new I(t.x,t.y,0),!0,t.status)});ut("isDestroyable",s).forEach(t=>{e.create().add(new ct,new I(t.x,t.y,0))});const r=s.find(t=>t.text&&t.text.text.length>0);r&&e.create().add(new V(r.text.text),new I(r.x,r.y),new $);t.layers[1].data.forEach((t,i)=>{0!==t&&e.create().add(new st(i%22,Math.floor(i/22)))})},pt=t=>{[ct,st,W,V,K,lt,Z,G].forEach(e=>{t.select(e).iterate(t=>{t.eject()})});t.select(rt).iterate(t=>{t.get(rt).roll()})};document.body.appendChild(document.createElement("canvas"));const gt=document.querySelector("canvas");gt.width=window.innerWidth,gt.height=window.innerHeight;const mt=()=>Math.min(window.innerWidth/22,window.innerHeight/12);window.tileSize=mt(),window.addEventListener("resize",()=>{gt.width=window.innerWidth,gt.height=window.innerHeight,window.tileSize=mt()});const St=gt.getContext("2d");window.mapLoader=(t=>{const e=[yt,ft];let i=-1;return{unload:()=>{pt(t)},next:()=>{pt(t),i++,i<e.length&&xt(e[i],t)}}})(j),j.register(I,N,Y,$,V,G,tt,K,W,et,st,it,Z,rt,Q,at,lt,ot,J,ct),j.process(((t,e)=>{const i=t.select(V,I),s=t.select(W);return{update:()=>{let t=-1;s.iterate(e=>{t+=e.get(W).remaining()}),i.iterate(i=>{const s=i.get(V),n=i.get(I);e.textAlign="center",e.font="50px sans-serif",e.fillStyle="rgba(100, 170, 220)";const r=s.sc.replace("%remain",t);e.fillText(r,n.x*tileSize,n.y*tileSize)})}}})(j,St),((t,e)=>{const i=t.select(I,J),s=t.select(st);return{update:t=>{i.iterate(t=>{const i=t.get(I),s=t.get(J);s.draw(i.clone().multiplyScalar(tileSize),e,s)}),s.iterate(t=>{const i=t.get(st);e.fillStyle="",e.fillRect(i.x*tileSize,i.y*tileSize,tileSize,tileSize)}),s.list&&(e.fillRect(0,0,22*tileSize,tileSize),e.fillRect(0,11*tileSize,22*tileSize,tileSize),e.fillRect(0,tileSize,tileSize,11*tileSize),e.fillRect(21*tileSize,tileSize,tileSize,11*tileSize))}}})(j,St),(t=>{const e=t.select(I,$,Y,N),i=t.select(rt);let s=!0;return{update:n=>{e.iterate(e=>{const{isUp:n,isDown:r,isLeft:a,isRight:l,isMain:o}=e.get($),c=e.get(I),h=e.get(N),d=e.get(Y);d.setScalar(0),n?d.setY(-.01):h.y<0&&!r&&h.setY(B(.02+h.y,-Number.MAX_VALUE,0)),r?d.setY(.01):h.y>0&&!n&&h.setY(B(-.02+h.y,0,Number.MAX_VALUE)),a?d.setX(-.01):h.x<0&&!l&&h.setX(B(.02+h.x,-Number.MAX_VALUE,0)),l?d.setX(.01):h.x>0&&!a&&h.setX(B(-.02+h.x,0,Number.MAX_VALUE)),h.add(d).clampScalar(-1/8,1/8),o||s||(s=!0),o&&s&&(s=!1,i.iterate(e=>{const i=e.get(rt);if(i.isAvailable()){const e=i.useBomb();t.create().add(e,new I(c.x,c.y,0),new J(U))}}))})}}})(j),((t,e)=>{const i=t.select(G),s=t.select(K,I),n=t.select(tt),r=t.select(ct,I);return{update:a=>{i.iterate(i=>{const l=i.get(G),o=i.get(I);switch(l.remaining-=a,((t,e,i)=>{switch(i.lineWidth=2,t.type){case 0:i.strokeStyle="#ffbd18";break;case 2:i.strokeStyle="#fff";break;case 1:i.strokeStyle="#00f";break;case 3:i.strokeStyle="#f00";break;case 4:i.strokeStyle="#0f0"}const s=t.radius*tileSize+5;i.beginPath(),i.moveTo(e.x+s*Math.cos(0),e.y+s*Math.sin(0));for(let t=1;t<=16;t++)i.lineTo(e.x+s*Math.cos(2*t*Math.PI/16),e.y+s*Math.sin(2*t*Math.PI/16));i.lineWidth=1,i.closePath(),i.stroke(),i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(e.x,e.y-t.radius*tileSize/2),i.arc(e.x,e.y,t.radius*tileSize/2,-Math.PI/2,-Math.PI/2+(t.total-t.remaining)/t.total*F),i.lineTo(e.x,e.y),i.fill()})(l,o.clone().multiplyScalar(tileSize),e),l.type){case 0:case 1:case 2:case 3:case 4:l.remaining<0?(l.triggered=!1,l.isArmed=!1,i.eject(),r.iterate(t=>{const e=t.get(I),i=t.get(ct);e.distance2D(o)<l.radius&&(i.exploded=!0)}),s.iterate(e=>{const i=e.get(I),s=e.get(N),n=e.get(K);3===n.status&&(n.status=null),i.distance2D(o)<l.radius&&(1===l.type?(n.effect=0,n.freezeTime=1100):2===l.type?(n.effect=1,n.effectTime=3300):(n.isActive=!1,s.setScalar(0),t.create().add(new J(X),new Z(performance.now()),new I(i.x,i.y,i.z))))}),t.create().add(new I(o.x,o.y,o.z),new ot(l.type))):3===l.type&&!1===l.triggered?s.iterate(t=>{const e=t.get(I);t.get(N),t.get(K);e.distance2D(o)<l.radius&&(l.triggered=!0,l.remaining=200)}):4===l.type&&!1===l.triggered&&n.iterate(t=>{const e=t.get(I);t.get(N);if(e.distance2D(o)<.5&&l.isArmed&&!i.get(N)){const t=o.clone().sub(e).normalise().multiplyScalar(.1);i.add(new N(t.x,t.y,t.z),new it(0,0,.4,.4))}e.distance2D(o)>1&&(l.isArmed=!0)})}})}}})(j,St),((t,e)=>{const i=t.select(W);return{update:t=>{i.iterate(i=>{const s=i.get(I),n=i.get(W);n.cd-=t,n.cd<=0&&n.total>0&&n.hasOne()?(n.cd=1e3,n.active(s),n.total--):n.cd>0&&n.total>0&&(e.beginPath(),e.arc(s.x*tileSize,s.y*tileSize,n.cd/1e3*20+10,0,F),e.closePath(),e.fillStyle="rgba(255, 255, 255, .3)",e.fill()),e.beginPath(),e.arc(s.x*tileSize,s.y*tileSize,10,0,F),e.closePath(),e.fillStyle=n.total>0?"rgba(255, 255, 255, .3)":"rgba(0, 0, 0, .3)",e.fill()})}}})(j,St),(t=>{const e=t.select(I,K),i=t.select(I,tt);return{update:s=>{i.iterate(i=>{const n=i.get(I);e.iterate(e=>{const i=e.get(K);if(i.effect&&(i.effectTime-=s),i.effectTime<0&&i.effect&&(i.effect=!1),3!==i.status&&i.isActive){const s=e.get(I),r=e.get(N);if(i.isAttacking||0===i.effect)r.setScalar(0);else if(1===i.effect);else{const t=n.clone().sub(s);r.set(t.normalise().multiplyScalar(.1))}n.distance2D(s)<1&&!i.isAttacking&&-1!==i.effect&&(i.isAttacking=!0,t.create().add(new Q(i,performance.now()),new I(s.x,s.y,s.z)))}})})}}})(j),((t,e)=>{const i=t.select(lt,I),s=t.select(tt,I),n=t.select(W);let r=-1;return{update:()=>{r=-1,n.iterate(t=>{r+=t.get(W).remaining()}),s.iterate(t=>{const s=t.get(I);i.iterate(t=>{const i=t.get(I),n=0===r||-1===r;switch(e.fillStyle=n?"#31cd39":"#9e333d",i.x){case 0:e.fillRect(5*tileSize,0*tileSize,4*tileSize,tileSize);break;case 1:n&&((t,e,i)=>t.x+1>e.x&&t.x<e.x+i.x&&t.y>e.y&&t.y<e.y+i.y)(s,new T(21,3),new T(1,4))&&(window.mapLoader.next(),s.x=1),e.fillRect(21*tileSize,3*tileSize,tileSize,4*tileSize);break;case 2:e.fillRect(5*tileSize,11*tileSize,4*tileSize,tileSize);break;case 3:e.fillRect(0*tileSize,3*tileSize,tileSize,4*tileSize)}})})}}})(j,St),((t,e)=>{const i=t.select(it,N,I),s=t.select(st);let n=!1;return{update:()=>{i.iterate(t=>{const e=t.get(I),i=t.get(N);if(0===i.x&&0===i.y)return;const r=t.get(it);e.x+r.xMin<1&&(e.x=1-r.xMin,i.x=-i.x),e.y+r.yMin<1&&(e.y=1-r.yMin,i.y=-i.y),e.x+r.xMax>21&&(e.x=21-r.xMax,i.x=-i.x),e.y+r.yMax>11&&(e.y=11-r.yMax,i.y=-i.y),n=!1,s.iterate(t=>{const s=t.get(st),a=e.clone();a.add(i),a.x+r.xMax>s.x&&a.x+r.xMax<s.x+1?a.y+r.yMax>s.y&&a.y+r.yMax<s.y+1?i.angle()<new T(a.x+r.xMax-s.x,a.y+r.yMax-s.y).angle()?(e.x=s.x-r.xMax,e.y+=i.y*((a.x-e.x)/i.x),i.x=-i.x,n=!0):(e.y=s.y-r.yMax,e.x+=i.x*((a.y-e.y)/i.y),i.y=-i.y):a.y+r.yMin>s.y&&a.y+r.yMin<s.y+1&&(i.angle()>new T(a.x+r.xMax-s.x,a.y+r.yMax-(s.y+1)).angle()?(e.y=s.y+r.xMax,e.x+=i.x*((a.y-e.y)/i.y),i.y=-i.y,n=!0):(e.x=s.x-r.xMax,e.y+=i.y*((a.x-e.x)/i.x),i.x=-i.x,n=!0)):a.x+r.xMin>s.x&&a.x+r.xMin<s.x+1&&(a.y+r.yMax>s.y&&a.y+r.yMax<s.y+1?i.angle()>new T(a.x+r.xMin-(s.x+1),a.y+r.yMax-s.y).angle()?(e.x=s.x+1+r.xMin,e.y+=i.y*((a.x-e.x)/i.x),i.x=-i.x,n=!0):(e.y=s.y-r.yMax,e.x+=i.x*((a.y-e.y)/i.y),i.y=-i.y,n=!0):a.y+r.yMin>s.y&&a.y+r.yMin<s.y+1&&(i.angle()<new T(a.x+r.xMin-(s.x+1),a.y+r.yMin-(s.y+1)).angle()?(e.x=s.x+r.xMax,e.y+=i.y*((a.x-e.x)/i.x),i.x=-i.x,n=!0):(e.y=s.y+r.yMax,e.x+=i.x*((a.y-e.y)/i.y),i.y=-i.y,n=!0)))}),n||e.add(i)})}}})(j),((t,e,i)=>{const s=new T(11*i-300,12*i-50),n=t.select(rt);return{update(t){n.iterate(i=>{const n=i.get(rt);n.rollTime+=t,n.rollTime>2e3&&n.isRolling&&n.roll();for(let t=1;t<=n.bombSlots.length;t++){let i=n.bombSlots[t-1];L(s,i,t,e,n.isRolling,n.rollTime/2e3)}n.isAvailable()||!n.isAllExploded()||n.isRolling||n.initRoll()})}}})(j,St,tileSize),((t,e)=>{const i=t.select(Z,I);return{update:()=>{i.iterate(t=>{const i=t.get(I);t.get(Z);X(i,e)})}}})(j,St),((t,e)=>{const i=t.select(ot,I);return{update:t=>{i.iterate(i=>{const s=i.get(ot);if(s.remaining-=t,s.remaining<0)i.eject();else{const t=i.get(I);switch(s.bombType){case 0:case 4:case 3:s.points.forEach(i=>{e.beginPath(),e.arc(i.x+t.x*tileSize,i.y+t.y*tileSize,.5*tileSize,0,F),e.fillStyle=`rgba(255,255,255,${1-s.remaining/300})`,e.fill(),i.multiplyScalar(1.33)});break;case 1:e.beginPath(),e.arc(t.x*tileSize,t.y*tileSize,2*tileSize,0,F),e.fillStyle=`rgba(0,0,255,${1-s.remaining/300})`,e.fill();break;case 2:e.beginPath(),e.arc(t.x*tileSize,t.y*tileSize,2*tileSize,0,F),e.fillStyle="rgba(255,255,255, 1)",e.fill()}}})}}})(j,St),((t,e)=>{const i=t.select(ct,I);return{update:t=>{i.iterate(t=>{const i=t.get(I),s=t.get(ct);s.blink++,((t,e,i)=>{console.log(i.exploded),t.fillStyle=i.exploded?"#000":"#fff",t.fillRect(e.x*tileSize,e.y*tileSize,tileSize,tileSize)})(e,i,s)})}}})(j,St),((t,e,i)=>{const s=t.select(Q),n=t.select(tt);t.select(rt);return{update:()=>{s.iterate(i=>{const s=i.get(Q),r=i.get(I);e.beginPath(),e.arc(r.x*tileSize,r.y*tileSize,2*tileSize,0,F),e.fillStyle="rgba(200,200,200, .4)",e.closePath(),e.fill(),performance.now()-s.at>500&&(n.iterate(t=>{const e=t.get(I),i=t.get(tt);r.distance2D(e)<2&&(i.hp-=15)}),s.hostile.isAttacking=!1,i.eject(),t.create().add(new I(r.x,r.y,r.z),new at(performance.now())))})}}})(j,St),((t,e)=>{const i=t.select(at);return{update:t=>{i.iterate(t=>{const i=t.get(at);if(performance.now()-i.at>300)return void t.eject();const s=t.get(I);e.beginPath(),e.fillStyle="rgba(200, 30, 30, .7)",e.arc(s.x*tileSize,s.y*tileSize,2*tileSize,0,F),e.closePath(),e.fill()})}}})(j,St),((t,e)=>{const i=t.select(et);return{update:()=>{i.iterate(t=>{const i=t.get(et);i.isButton?(e.fillStyle="#fff",e.fillRect(i.x,i.y,300,100),e.textAlign="center",e.fillStyle="#000",e.fillText(i.text,i.x+150,i.y+50)):(e.fillStyle="#000",e.fillText(i.text,i.x+150,i.y+50))})}}})(j,St),((t,e)=>{const i=t.select(tt),s=new T(11*tileSize-210,10);return{update:()=>{i.iterate(i=>{const n=i.get(tt);n.hp<=0?(mapLoader.unload(t),window.currentScreen=((t,e)=>({isGame:!1,load:()=>{t.create().add(new et("You died",22*e/2,12*e/2,()=>{},!1)),t.create().add(new et("Restart",22*e/2,12*e/2+150,()=>{window.currentScreen.unload(),window.currentScreen=dt(t).load()},!0))},unload:()=>{}}))(t,tileSize),window.currentScreen.load()):(e.fillStyle="#000",e.fillRect(s.x,s.y,420,50),e.fillStyle="red",e.fillRect(s.x+10,s.y+10,4*n.hp,30),e.font="400 22px Arial",e.fillStyle="#000",e.fillText("HP",s.x+17,s.y+35),e.fillStyle="#fff",e.fillText("HP",s.x+15,s.y+33))})}}})(j,St)),window.currentScreen=ht(j,gt),ht(j,gt).load();let wt,bt=0;const vt=()=>{wt=performance.now(),gt.width+=0,j.update(wt-bt),bt=wt,requestAnimationFrame(vt)};vt()}]);