!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t){t.exports=JSON.parse("{}")},function(t,e,i){"use strict";i.r(e);const s=Math;function n(t){return s.sin(6.283184*t)}var r=[n,function(t){return n(t)<0?-1:1},function(t){return t%1-.5},function(t){var e=t%1*4;return e<2?e-1:3-e}];function o(t){return.00390625*s.pow(1.059463094,t-128)}function a(t){return{left:new Float32Array(t),right:new Float32Array(t)}}function c(t,e,i,s){for(var n=i.fx_delay_time*s>>1,r=i.fx_delay_amt/255,o=0;o<e-n;){var a=o,c=o+n;t.left[c]+=t.right[a]*r,t.right[c]+=t.left[a]*r,o++}}function h(t,e){var i=t.createBuffer(2,e.left.length,44100);return i.getChannelData(0).set(e.left),i.getChannelData(1).set(e.right),i}var l=function(t,e,i){this.ctx=t,this.instr=e,this.rowLen=i||5605,this.osc_lfo=r[e.lfo_waveform],this.osc1=r[e.osc1_waveform],this.osc2=r[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=s.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=s.pow(2,e.lfo_freq-8)/this.rowLen};l.prototype._genSound=function(t,e,i){for(var r=0,a=0,c=o(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),h=o(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),l=this.instr.fx_resonance/255,u=0,d=0,x=e.left.length,f=this.attack+this.sustain+this.release-1;f>=0;--f){var y=f+i,p=this.osc_lfo(y*this.lfoFreq)*this.instr.lfo_amt/512+.5,m=1;f<this.attack?m=f/this.attack:f>=this.attack+this.sustain&&(m-=(f-this.attack-this.sustain)/this.release);var g=c;this.instr.lfo_osc1_freq&&(g+=p),this.instr.osc1_xenv&&(g*=m*m),r+=g;var w=this.osc1(r)*this.instr.osc1_vol;g=h,this.instr.osc2_xenv&&(g*=m*m),a+=g,w+=this.osc2(a)*this.instr.osc2_vol,this.instr.noise_fader&&(w+=(2*s.random()-1)*this.instr.noise_fader*m),w*=m/255;var v=this.instr.fx_freq;this.instr.lfo_fx_freq&&(v*=p);var b=l*(w-d)-(u+=(v=1.5*s.sin(3.141592*v/44100))*d);switch(d+=v*b,this.instr.fx_filter){case 1:w=b;break;case 2:w=u;break;case 3:w=d;break;case 4:w=u+b}g=n(y*this.panFreq)*this.instr.fx_pan_amt/512+.5,w*=.00476*this.instr.env_master,y<x&&(e.left[y]+=w*(1-g),e.right[y]+=w*g)}},l.prototype._createAudioBuffer=function(t,e){var i=this.attack+this.sustain+this.release-1+32*this.rowLen,s=a(i);this._genSound(t,s,0),c(s,i,this.instr,this.rowLen),e(h(this.ctx,s))};var u=function(t,e){this.ctx=t,this.song=e,this.waveSize=44100*e.songLen};u.prototype._generateTrack=function(t,e,i){var s=a(this.waveSize),n=this.waveSize,r=this.song.rowLen,o=this.song.endPattern,h=new l(this.ctx,t,r),u=0,d=0,x=0,f=function(){for(var e=Date.now();;)if(32!==x){if(d===o-1)return y();var i=t.p[d];if(i){var n=t.c[i-1].n[x];n&&h._genSound(n,s,u)}if(u+=r,x+=1,Date.now()-e>33)return void setTimeout(f,0)}else x=0,d+=1},y=function(){c(s,n,t,r);for(var o=0;o<n;o++)e.left[o]+=s.left[o];for(o=0;o<n;o++)e.right[o]+=s.right[o];i()};f()},u.prototype._createAudioBuffer=function(t){var e=this,i=a(this.waveSize),s=0,n=function(){s<e.song.songData.length?(s+=1,e._generateTrack(e.song.songData[s-1],i,n)):t(h(e.ctx,i))};n()};new(window.webkitAudioContext||window.AudioContext);i(0);var d=[],f=[],p={},m="_sign",g="_mask";"undefined"!=typeof Symbol&&(m=Symbol(m),g=Symbol(g));var w=function(t,e){var i=e[t];if(!i)throw new Error("The component is not registered");return i},v=w.bind(null,m),b=w.bind(null,g),M=function(t){t.id&&d.forEach((function(e){return e.match(t)}))},_=1,S={},k=function(t){this.id=t||(_++).toString(36),this.components=Object.assign({},S),this.mask=0};k.prototype.add=function(){for(var t=this,e=[],i=arguments.length;i--;)e[i]=arguments[i];e.forEach((function(e){t.components[v(e.constructor)]=e,t.mask|=b(e.constructor)})),M(this)},k.prototype.remove=function(){for(var t=this,e=[],i=arguments.length;i--;)e[i]=arguments[i];e.forEach((function(e){var i=v(e),s=t.components[i];s&&(s.destructor&&s.destructor(),delete t.components[i],t.mask&=~b(e))})),M(this)},k.prototype.has=function(t){return v(t)in this.components},k.prototype.get=function(t){return this.components[t[m]]},k.prototype.eject=function(){!function(t){var e=t.components;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=e[i];s&&s.destructor&&s.destructor()}d.forEach((function(e){return e.remove(t)})),delete p[t.id],t.id=0}(this)};var A=function(t,e){this.entity=t,this.prev=null,this.next=e},P=function(t){if(!t)throw new Error("Empty selector");for(var e in this.mask=t,this.map={},this.list=null,this.length=0,p)Object.prototype.hasOwnProperty.call(p,e)&&this.match(p[e])};P.prototype.iterate=function(t){for(var e=this.list;e;)t(e.entity),e=e.next},P.prototype.match=function(t){(this.mask&t.mask)===this.mask?this.add(t):this.remove(t)},P.prototype.add=function(t){if(!this.map[t.id]){var e=new A(t,this.list);this.list&&(this.list.prev=e),this.list=e,this.map[t.id]=e,this.length++}},P.prototype.remove=function(t){var e=this.map[t.id];e&&(e.prev?e.prev.next=e.next:this.list=e.next,e.next&&(e.next.prev=e.prev),delete this.map[t.id],this.length--)};var E=0,C=performance||Date,D=C.now.bind(C),L={register:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach((function(t){if(E>31)throw new Error("Components limit reached");if(!t[m]){var e=E.toString(36);S[e]=null,t[m]=e,t[g]=1<<E,E++}}))},process:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach((function(t){return f.push(t)}))},create:function(t){var e=new k(t);if(p[e.id])throw new Error("The ID already exist");return p[e.id]=e,e},get:function(t){return p[t]},select:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var i=0;t.forEach((function(t){i|=b(t)}));for(var s=0;s<d.length;s++)if(d[s].mask===i)return d[s];var n=new P(i);return d.push(n),n},update:function(t){var e={};return f.forEach((function(i){var s=D();i.update(t),e[i.constructor.name]=D()-s})),e}};class U{constructor(t,e,i){this.x=t,this.y=e,this.z=i}setX(t){this.x=t}setY(t){this.y=t}setZ(t){this.z=t}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}setScalar(t){return this.x=t,this.y=t,this.z=t,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}divideScalar(t){return this.multiplyScalar(1/t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}clone(){return new U(this.x,this.y,this.z)}distance2D(t){return Math.hypot(this.x-t.x,this.y-t.y)}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}normalise(){return this.divideScalar(this.length())}set(t){this.x=t.x,this.y=t.y,this.z=t.z}toString(){return`${x} ${y} ${z}`}}const j=[{radius:1,timer:3e3},{radius:2,timer:3e3},{radius:3,timer:3e3},{radius:4,timer:3e3},{radius:5,timer:3e3},{radius:6,timer:3e3}],O=(t,e,i)=>Math.max(e,Math.min(i,t)),T=2*Math.PI;console.log(O(1,0,2));class q extends U{}class X extends U{}class F extends U{}class R{constructor(t){this.cd=3e3,this.maxHostiles=3;for(let e=0;e<this.maxHostiles;e++)t.create().add(new I,new q(0,0,0),new H(V),new Z(-.5,-.5,.5,.5))}}class N{constructor(){this.isUp=!1,this.isLeft=!1,this.isRight=!1,this.isDown=!1,this.isMain=!1,window.addEventListener("keydown",t=>{90!==t.keyCode&&87!==t.keyCode||(this.isUp=!0),32===t.keyCode&&(this.isMain=!0),81!==t.keyCode&&65!==t.keyCode||(this.isLeft=!0),68===t.keyCode&&(this.isRight=!0),83===t.keyCode&&(this.isDown=!0)}),window.addEventListener("keyup",t=>{90!==t.keyCode&&87!==t.keyCode||(this.isUp=!1),32===t.keyCode&&(this.isMain=!1),81!==t.keyCode&&65!==t.keyCode||(this.isLeft=!1),68===t.keyCode&&(this.isRight=!1),83===t.keyCode&&(this.isDown=!1)})}}class Y{constructor(){this.isUpPressed=!1,this.isDownPressed=!1}}class B{constructor(t,e){this.timer=t,this.radius=e}}const V=2;class H{constructor(t){this.draw=(e,i,s)=>{e.fillStyle="#134",0===t?(e.beginPath(),e.arc(i.x,i.y,1*s/2,0,T),e.fill(),e.closePath()):t===V?(e.beginPath(),e.arc(i.x,i.y,.5*s/4,0,T),e.closePath(),e.fill()):(e.stroke(),e.fillRect(i.x-8,i.y-8,16,16))}}}class ${constructor(t){this.diedAt=t}}class I{constructor(t,e){this.target=t,this.isActive=!1,this.type=e,this.isAttacking=!1}}class W{constructor(t,e){this.hostile=t,this.at=e}}class G{}class J{constructor(t,e,i,s){this.text=t,this.x=e,this.y=i,window.addEventListener("mousedown",t=>{Math.abs(t.pageX-e)<100&&Math.abs(t.pageY-i)<100&&s()})}}class Z{constructor(t,e,i,s){this.xMin=t,this.yMin=e,this.xMax=i,this.yMax=s}}class K extends U{}class Q{constructor(t){this.cd=t,this.isAvailable=!0,this.roll(),this.bomb=null}use(){const t=j[this.type];return this.bomb=new B(t.timer,t.radius),this.isAvailable=!1,this.bomb}roll(){this.type=Math.floor(6*Math.random()),this.isAvailable=!0}}class tt{constructor(t,e){this.maxSize=t,this.bombSlots=[];for(let i=0;i<t;i++)this.bombSlots.push(new Q(e))}isAvailable(){for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isAvailable)return!0;return!1}isAllExploded(){for(let t=0;t<this.bombSlots.length;t++)if(!this.bombSlots[t].bomb)return!1;for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].bomb.timer>0)return!1;return!0}useBomb(){for(let t=0;t<this.bombSlots.length;t++)if(this.bombSlots[t].isAvailable)return this.bombSlots[t].use()}roll(){for(let t=0;t<this.bombSlots.length;t++)this.bombSlots[t].roll()}}const et=(t,e)=>({load:()=>{t.create().add(new J("Start",e.width/2,e.height/2,()=>{window.currentScreen.unload(),window.currentScreen=it(t,e)}))},unload:()=>{t.select(J).iterate(t=>{t.eject()})}}),it=(t,e)=>{t.create().add(new tt(3,3e3)),t.create().add(new H(0),new q(10,5,0),new X(0,0,0),new F(0,0,0),new N,new G,new Z(-.5,-.5,.5,.5)),t.create().add(new R(t),new q(1,5,0)),t.create().add(new Y,new N);const i=[0,0,19,0,0,9,19,9,5,5,6,5,7,5,8,5,5,6,5,7,5,8];for(let e=0;e<i.length;e+=2)t.create().add(new K(i[e],i[e+1]))};document.body.appendChild(document.createElement("canvas"));const st=document.querySelector("canvas");st.width=window.innerWidth,st.height=window.innerHeight;const nt=Math.min(st.width/20,st.height/10),rt=st.getContext("2d");L.register(q,X,F,N,Y,H,B,G,I,R,J,K,Z,$,tt,W),L.process(((t,e,i)=>{const s=t.select(q,H),n=t.select(K);return{update:t=>{s.iterate(t=>{const s=t.get(q);t.get(H).draw(e,s.clone().multiplyScalar(i),i)}),n.iterate(t=>{const s=t.get(K);e.fillRect(s.x*i,s.y*i,i,i)})}}})(L,rt,nt),(t=>{const e=t.select(q,N),i=t.select(Y,N),s=t.select(tt);let n=!0;return{update:r=>{i.iterate(t=>{const{isUp:e,isDown:i}=t.get(N);e&&(t.get(Y).isUpPressed=!0),i&&(t.get(Y).isDownPressed=!0)}),e.iterate(e=>{const{isUp:i,isDown:r,isLeft:o,isRight:a,isMain:c}=e.get(N),h=e.get(q),l=e.get(X),u=e.get(F);u.setScalar(0),i?u.setY(-.01):l.y<0&&!r&&l.setY(O(.02+l.y,-Number.MAX_VALUE,0)),r?u.setY(.01):l.y>0&&!i&&l.setY(O(-.02+l.y,0,Number.MAX_VALUE)),o?u.setX(-.01):l.x<0&&!a&&l.setX(O(.02+l.x,-Number.MAX_VALUE,0)),a?u.setX(.01):l.x>0&&!o&&l.setX(O(-.02+l.x,0,Number.MAX_VALUE)),l.add(u).clampScalar(-.3,.3),h.add(l),c||n||(n=!0),c&&n&&(n=!1,s.iterate(e=>{const i=e.get(tt);if(i.isAvailable()){const e=i.useBomb();t.create().add(e,new q(h.x,h.y,0),new H(1))}}))})}}})(L),((t,e)=>{const i=t.select(Y);return{update:t=>{i.iterate(t=>{t.get(Y).isUpPressed||t.get(Y).isUpPressed?t.get(Y).isDownPressed&&t.get(Y).isUpPressed?e.fillText("Good Dog !",10,50):t.get(Y).isUpPressed&&e.fillText("Press DOWN",10,50):e.fillText("Press Up",10,50)})}}})(L,rt),((t,e,i)=>{const s=t.select(B),n=t.select(I,q);return{update:r=>{s.iterate(s=>{const o=s.get(B),a=s.get(q);o.timer-=r;const c=a.x*i,h=a.y*i;e.beginPath(),e.arc(c,h,o.radius*i,0,T),e.closePath(),e.stroke(),e.fillText(Math.ceil(o.timer/1e3),c,h-20),o.timer<0&&(s.eject(),n.iterate(e=>{const i=e.get(q),s=e.get(I);i.distance2D(a)<o.radius&&(s.isActive=!1,t.create().add(new $(performance.now()),new q(i.x,i.y,i.z)))}))})}}})(L,rt,nt),(t=>{const e=t.select(R),i=t.select(I);return{update:t=>{e.iterate(e=>{const s=e.get(q),n=e.get(R);if(n.cd-=t,n.cd<0){n.cd=3e3;let t=!1;i.iterate(e=>{const i=e.get(I);if(!i.isActive&&!t){i.isActive=!0;e.get(q).set(s),t=!0}})}})}}})(L),(t=>{const e=t.select(q,I),i=t.select(q,G);return{update:s=>{i.iterate(i=>{const s=i.get(q);e.iterate(e=>{const i=e.get(I);if(i.isActive){const n=e.get(q);if(!i.isAttacking){const t=s.clone().sub(n).normalise().multiplyScalar(.1);n.add(t)}s.distance2D(n)<1&&!i.isAttacking&&(i.isAttacking=!0,t.create().add(new W(i,performance.now()),new q(n.x,n.y,n.z)))}})})}}})(L),((t,e)=>{const i=t.select(J);return{update:()=>{i.iterate(t=>{const i=t.get(J);e.fillText(i.text,i.x,i.y)})}}})(L,rt),(t=>{const e=t.select(Z,X,q),i=t.select(K);return{update:()=>{e.iterate(t=>{const e=t.get(q),s=t.get(X),n=t.get(Z);e.x+n.xMin<0&&(e.x=-n.xMin,s.x=-s.x),e.y+n.yMin<0&&(e.y=-n.yMin,s.y=-s.y),e.x-n.xMax>19&&(e.x=19+n.xMax,s.x=-s.x),e.y-n.yMax>9&&(e.y=9+n.yMax,s.y=-s.y),i.iterate(t=>{const i=t.get(K),r=e.clone();s.x>0&&e.x+n.xMax>i.x&&e.x+n.xMax<i.x+1&&(e.y+n.yMax>i.y&&e.y+n.yMax<i.y+1||e.y+n.yMin>i.y&&e.y+n.yMin<i.y+1)&&(r.x=n.xMin+i.x+(n.xMin+i.x-r.x),s.x=-s.x),s.x<0&&e.x+n.xMin>i.x&&e.x+n.xMin<i.x+1&&(e.y+n.yMax>i.y&&e.y+n.yMax<i.y+1||e.y+n.yMin>i.y&&e.y+n.yMin<i.y+1)&&(console.log(n.xMax+i.x+1-r.x),r.x=n.xMax+i.x+1+(n.xMax+i.x+1-r.x),s.x=-s.x),s.y<0&&e.y+n.yMin>i.y&&e.y+n.yMin<i.y+1&&(e.x+n.xMin>i.x&&e.x+n.xMin<i.x+1||e.x+n.xMax>i.x&&e.x+n.xMax<i.x+1)&&(r.y=n.xMax+i.y+1+(n.xMax+i.y+1-r.y),s.y=-s.y),s.y>0&&e.y+n.xMax>i.y&&e.y+n.xMax<i.y+1&&(e.x+n.xMin>i.x&&e.x+n.xMin<i.x+1||e.x+n.xMax>i.x&&e.x+n.xMax<i.x+1)&&(r.y=n.xMin+i.y+(n.xMin+i.y-r.y),s.y=-s.y),e.set(r)})})}}})(L),((t,e,i)=>{const s=t.select(tt);return{update(){s.iterate(t=>{const s=t.get(tt);for(let t=1;t<=s.bombSlots.length;t++){let n=s.bombSlots[t-1];e.fillRect(i.width-105*t,i.height-100,100,100),e.fillText(n.isAvailable,i.width-105*t,i.height-100),e.fillText(n.type,i.width-105*t,i.height-110)}!s.isAvailable()&&s.isAllExploded()&&s.roll()})}}})(L,rt,st),((t,e,i)=>{const s=t.select($,q);return{update:()=>{s.iterate(t=>{const s=t.get(q);t.get($);e.fillStyle="#eee",e.beginPath(),e.arc(s.x*i,s.y*i,10,0,T),e.closePath(),e.fill()})}}})(L,rt,nt),((t,e,i)=>{const s=t.select(W);return{update:()=>{s.iterate(t=>{const s=t.get(W),n=t.get(q);e.beginPath(),e.arc(n.x*i,n.y*i,2*i,0,T),e.fillStyle="rgba(200,200,200, .4)",e.closePath(),e.fill(),performance.now()-s.at>1e3&&(s.hostile.isAttacking=!1,t.eject())})}}})(L,rt,nt)),window.currentScreen=et(L,st),et(L,st).load();let ot,at=0;const ct=()=>{ot=performance.now(),st.width+=0,L.update(ot-at),at=ot,requestAnimationFrame(ct)};ct()}]);